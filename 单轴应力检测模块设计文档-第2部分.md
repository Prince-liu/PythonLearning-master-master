# å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£ v1.0 - ç¬¬2éƒ¨åˆ†

> **åŒ…å«ç« èŠ‚**ï¼šç¬¬4ç«  å½¢çŠ¶å®šä¹‰åŠŸèƒ½ã€ç¬¬5ç«  å¸ƒç‚¹ç­–ç•¥ã€ç¬¬6ç«  é‡‡é›†æµç¨‹  
> **ä¸Šä¸€éƒ¨åˆ†**ï¼š[ç¬¬1.5éƒ¨åˆ†](./å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£-ç¬¬1.5éƒ¨åˆ†.md)  
> **ä¸‹ä¸€éƒ¨åˆ†**ï¼š[ç¬¬3éƒ¨åˆ†](./å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£-ç¬¬3éƒ¨åˆ†.md)

---

## 4. å½¢çŠ¶å®šä¹‰åŠŸèƒ½

### 4.1 çŸ©å½¢æ¨¡å¼

#### å‚æ•°å®šä¹‰
```python
shape_config = {
    "type": "rectangle",
    "width": 100,      # mm
    "height": 150,     # mm
    "modifiers": []    # å¸ƒå°”è¿ç®—åˆ—è¡¨
}
```

#### ç•Œé¢æ“ä½œ
```
è¯•ä»¶å½¢çŠ¶: [â—çŸ©å½¢] [â—‹åœ†å½¢] [â—‹è‡ªå®šä¹‰]

åŸºç¡€å‚æ•°:
  å®½åº¦ (mm): [100]
  é«˜åº¦ (mm): [150]

å½¢çŠ¶ç¼–è¾‘ (å¯é€‰):
  â˜‘ å¯ç”¨å¸ƒå°”è¿ç®—
  
  [+ æ·»åŠ å­”æ´/ç¼ºå£]  [+ æ·»åŠ å‡¸èµ·]
  
  å·²æ·»åŠ :
  â— åœ†å½¢å­” - ä¸­å¿ƒ(50,75) åŠå¾„20mm [ç¼–è¾‘] [åˆ é™¤]
  â— çŸ©å½¢ç¼ºå£ - å·¦ä¸Š(0,60) å®½20 é«˜30 [ç¼–è¾‘] [åˆ é™¤]
```

#### å¸ƒå°”è¿ç®—ç±»å‹
- **å‡å»ï¼ˆå­”æ´/ç¼ºå£ï¼‰**ï¼š
  - åœ†å½¢å­”ï¼šä¸­å¿ƒåæ ‡ + åŠå¾„
  - çŸ©å½¢æ§½ï¼šå·¦ä¸Šè§’åæ ‡ + å®½é«˜
  - Uå‹ç¼ºå£ï¼šä½ç½® + å°ºå¯¸
  
- **æ·»åŠ ï¼ˆå‡¸èµ·ï¼‰**ï¼š
  - çŸ©å½¢å‡¸å°ï¼šä½ç½® + å°ºå¯¸
  - åœ†å½¢å‡¸èµ·ï¼šä¸­å¿ƒ + åŠå¾„

### 4.2 åœ†å½¢æ¨¡å¼

#### å‚æ•°å®šä¹‰
```python
shape_config = {
    "type": "circle",
    "center_x": 50,
    "center_y": 50,
    "outer_radius": 40,
    "inner_radius": 0,      # 0è¡¨ç¤ºå®å¿ƒåœ†
    "start_angle": 0,       # 0è¡¨ç¤ºå®Œæ•´åœ†
    "end_angle": 360,
    "modifiers": []
}
```

#### ç•Œé¢æ“ä½œ
```
è¯•ä»¶å½¢çŠ¶: [â—‹çŸ©å½¢] [â—åœ†å½¢] [â—‹è‡ªå®šä¹‰]

åŸºç¡€å‚æ•°:
  åœ†å¿ƒ X (mm): [50]
  åœ†å¿ƒ Y (mm): [50]
  å¤–åŠå¾„ (mm): [40]

æ£€æµ‹åŒºåŸŸé™åˆ¶:
  â˜‘ å¯ç”¨æ‰‡å½¢åŒºåŸŸ
    èµ·å§‹è§’åº¦ (Â°): [0]
    ç»“æŸè§’åº¦ (Â°): [90]
  
  â˜‘ å¯ç”¨åœ†ç¯åŒºåŸŸ
    å†…åŠå¾„ (mm): [10]
    (ä¸æ£€æµ‹åœ†å¿ƒåŒºåŸŸ)

å½¢çŠ¶ç¼–è¾‘:
  [+ æ·»åŠ å­”æ´]  [+ æ·»åŠ ç¼ºå£]
```

#### å…¸å‹åº”ç”¨åœºæ™¯
- **åœ†ç›˜**ï¼šouter_radius=50, inner_radius=0
- **åœ†ç¯**ï¼šouter_radius=50, inner_radius=20
- **æ‰‡å½¢**ï¼šouter_radius=50, start_angle=0, end_angle=90
- **åœ†ç¯æ‰‡å½¢**ï¼šç»„åˆä¸Šè¿°å‚æ•°

### 4.3 è‡ªå®šä¹‰å¤šè¾¹å½¢æ¨¡å¼

#### å‚æ•°å®šä¹‰
```python
shape_config = {
    "type": "polygon",
    "vertices": [
        [0, 0],
        [100, 0],
        [100, 50],
        [50, 50],
        [50, 100],
        [0, 100]
    ],
    "modifiers": []
}
```

#### ç•Œé¢æ“ä½œ
```
è¯•ä»¶å½¢çŠ¶: [â—‹çŸ©å½¢] [â—‹åœ†å½¢] [â—è‡ªå®šä¹‰]

ç»˜åˆ¶æ–¹å¼:
  â—‹ ç‚¹å‡»ç”»å¸ƒæ·»åŠ é¡¶ç‚¹
  â—‹ è¾“å…¥åæ ‡

é¡¶ç‚¹åˆ—è¡¨:
  #1: (0, 0)      [åˆ é™¤] [â†‘] [â†“]
  #2: (100, 0)    [åˆ é™¤] [â†‘] [â†“]
  #3: (100, 50)   [åˆ é™¤] [â†‘] [â†“]
  #4: (50, 50)    [åˆ é™¤] [â†‘] [â†“]
  #5: (50, 100)   [åˆ é™¤] [â†‘] [â†“]
  #6: (0, 100)    [åˆ é™¤] [â†‘] [â†“]
  
  [+ æ·»åŠ é¡¶ç‚¹] [é—­åˆè½®å»“] [æ¸…ç©º]
  
æç¤º: åœ¨å³ä¾§ç”»å¸ƒä¸Šç‚¹å‡»æ·»åŠ é¡¶ç‚¹
```

#### äº¤äº’æ–¹å¼
1. **ç‚¹å‡»æ·»åŠ **ï¼šåœ¨é¢„è§ˆç”»å¸ƒä¸Šç‚¹å‡»ï¼Œè‡ªåŠ¨è®°å½•åæ ‡
2. **æ‰‹åŠ¨è¾“å…¥**ï¼šç›´æ¥è¾“å…¥åæ ‡å€¼
3. **æ‹–æ‹½è°ƒæ•´**ï¼šæ‹–åŠ¨é¡¶ç‚¹ä¿®æ”¹ä½ç½®
4. **é¡ºåºè°ƒæ•´**ï¼šä½¿ç”¨ â†‘â†“ æŒ‰é’®è°ƒæ•´é¡¶ç‚¹é¡ºåº

### 4.4 å½¢çŠ¶éªŒè¯ä¸é¢„è§ˆ

#### å®æ—¶é¢„è§ˆ
- åœ¨å³ä¾§ç”»å¸ƒå®æ—¶æ˜¾ç¤ºå½¢çŠ¶è½®å»“
- å­”æ´/ç¼ºå£ç”¨è™šçº¿æˆ–ä¸åŒé¢œè‰²æ ‡æ³¨
- æ˜¾ç¤ºå…³é”®å°ºå¯¸æ ‡æ³¨

#### æœ‰æ•ˆæ€§æ£€æŸ¥
```python
def validate_shape(shape_config):
    """éªŒè¯å½¢çŠ¶é…ç½®çš„æœ‰æ•ˆæ€§"""
    checks = {
        "é¢ç§¯æ£€æŸ¥": area > 0,
        "è¾¹ç•Œæ£€æŸ¥": all_points_within_bounds,
        "å­”æ´æ£€æŸ¥": holes_within_shape,
        "è‡ªç›¸äº¤æ£€æŸ¥": no_self_intersection
    }
    return checks
```

#### é”™è¯¯æç¤º
- âŒ å½¢çŠ¶é¢ç§¯ä¸ºé›¶æˆ–è´Ÿå€¼
- âŒ å­”æ´è¶…å‡ºè¯•ä»¶è¾¹ç•Œ
- âŒ å¤šè¾¹å½¢è‡ªç›¸äº¤
- âš ï¸ æœ‰æ•ˆæµ‹é‡åŒºåŸŸè¿‡å°ï¼ˆ< 10% æ€»é¢ç§¯ï¼‰

---

## 5. å¸ƒç‚¹ç­–ç•¥

### 5.1 ç½‘æ ¼å¸ƒç‚¹ï¼ˆæœ€å¸¸ç”¨ï¼‰

#### å‚æ•°è®¾ç½®
```
å¸ƒç‚¹æ–¹å¼: [ç½‘æ ¼å¸ƒç‚¹ â–¼]

ç½‘æ ¼å‚æ•°:
  è¡Œæ•°: [5]
  åˆ—æ•°: [5]
  è¡Œé—´è· (mm): [10] [å˜è·]
  åˆ—é—´è· (mm): [10] [å˜è·]
  è¾¹è· (mm): [10]
  
[é¢„è§ˆå¸ƒç‚¹] [ç”Ÿæˆæµ‹ç‚¹]
```

#### å˜è·è¾“å…¥å¼¹çª—
ç‚¹å‡»"å˜è·"æŒ‰é’®åå¼¹å‡ºè¾“å…¥æ¡†:

**è¡Œé—´è·å˜è·è®¾ç½®**
```
è¡Œé—´è·æ•°ç»„ (å…±4ä¸ªé—´è·ï¼Œ5è¡Œéœ€è¦4ä¸ªé—´è·):
  ç¬¬1-2è¡Œé—´è· (mm): [10]
  ç¬¬2-3è¡Œé—´è· (mm): [15]
  ç¬¬3-4è¡Œé—´è· (mm): [15]
  ç¬¬4-5è¡Œé—´è· (mm): [10]

[ç¡®å®š] [å–æ¶ˆ] [æ¢å¤ç­‰è·]
```

**åˆ—é—´è·å˜è·è®¾ç½®**
```
åˆ—é—´è·æ•°ç»„ (å…±4ä¸ªé—´è·ï¼Œ5åˆ—éœ€è¦4ä¸ªé—´è·):
  ç¬¬1-2åˆ—é—´è· (mm): [10]
  ç¬¬2-3åˆ—é—´è· (mm): [12]
  ç¬¬3-4åˆ—é—´è· (mm): [12]
  ç¬¬4-5åˆ—é—´è· (mm): [10]

[ç¡®å®š] [å–æ¶ˆ] [æ¢å¤ç­‰è·]
```

#### ç”Ÿæˆç®—æ³•
```python
def generate_grid_points(shape_config, rows, cols, row_spacings, col_spacings, margin):
    """ç”Ÿæˆç½‘æ ¼æµ‹ç‚¹ï¼ˆæ”¯æŒå˜é—´è·ï¼‰
    
    Args:
        shape_config: å½¢çŠ¶é…ç½®
        rows: è¡Œæ•°
        cols: åˆ—æ•°
        row_spacings: è¡Œé—´è·æ•°ç»„ [s1, s2, ..., s(n-1)] æˆ–å•ä¸ªå€¼ï¼ˆç­‰è·ï¼‰
        col_spacings: åˆ—é—´è·æ•°ç»„ [s1, s2, ..., s(m-1)] æˆ–å•ä¸ªå€¼ï¼ˆç­‰è·ï¼‰
        margin: è¾¹è·
    """
    # å¤„ç†ç­‰è·æƒ…å†µ
    if isinstance(row_spacings, (int, float)):
        row_spacings = [row_spacings] * (rows - 1)
    if isinstance(col_spacings, (int, float)):
        col_spacings = [col_spacings] * (cols - 1)
    
    # è®¡ç®—èµ·å§‹ä½ç½®
    x_start = margin
    y_start = margin
    
    # ç”ŸæˆYåæ ‡ï¼ˆè¡Œï¼‰
    y_coords = [y_start]
    for spacing in row_spacings:
        y_coords.append(y_coords[-1] + spacing)
    
    # ç”ŸæˆXåæ ‡ï¼ˆåˆ—ï¼‰
    x_coords = [x_start]
    for spacing in col_spacings:
        x_coords.append(x_coords[-1] + spacing)
    
    # ç”Ÿæˆæµ‹ç‚¹
    points = []
    index = 1
    for y in y_coords:
        for x in x_coords:
            # æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨æœ‰æ•ˆåŒºåŸŸå†…ï¼ˆæ’é™¤å­”æ´ï¼‰
            if is_point_valid(x, y, shape_config):
                points.append({
                    'id': index,
                    'x': round(x, 2),
                    'y': round(y, 2),
                    'status': 'pending'
                })
                index += 1
    
    return points
```

#### ç¤ºä¾‹æ•ˆæœ

**ç­‰è·ç½‘æ ¼**
```
è¯•ä»¶ 100Ã—150 mmï¼Œ5Ã—5 ç½‘æ ¼ï¼Œç­‰è· 10mmï¼Œè¾¹è· 10mm

â— â— â— â— â—
â— â— â—‹ â— â—  â† â—‹ è¡¨ç¤ºå­”æ´ä½ç½®ï¼Œè‡ªåŠ¨è·³è¿‡
â— â— â— â— â—
â— â— â— â— â—
â— â— â— â— â—

ç”Ÿæˆ 24 ä¸ªæœ‰æ•ˆæµ‹ç‚¹ï¼ˆ1ä¸ªè¢«å­”æ´æ’é™¤ï¼‰
```

**å˜è·ç½‘æ ¼ï¼ˆåº”åŠ›é›†ä¸­åŒºåŸŸåŠ å¯†ï¼‰**
```
è¯•ä»¶ 100Ã—150 mmï¼Œ5Ã—5 ç½‘æ ¼ï¼Œå˜è·è®¾ç½®
è¡Œé—´è·: [10, 5, 5, 10] mm
åˆ—é—´è·: [10, 5, 5, 10] mm

â—   â—   â—   â—   â—
  
â—   â— â— â— â—   â—
    â†‘ ä¸­é—´åŒºåŸŸåŠ å¯†
â—   â— â— â— â—   â—

â—   â—   â—   â—   â—

é€‚ç”¨äºä¸­å¿ƒåŒºåŸŸåº”åŠ›é›†ä¸­çš„åœºæ™¯
```

### 5.2 æåæ ‡å¸ƒç‚¹

#### å‚æ•°è®¾ç½®
```
å¸ƒç‚¹æ–¹å¼: [æåæ ‡å¸ƒç‚¹ â–¼]

åœ†å¿ƒä½ç½®:
  X åæ ‡ (mm): [50]  ğŸ’¡ç‚¹å‡»ç”»å¸ƒè®¾ç½®
  Y åæ ‡ (mm): [50]

å¾„å‘å‚æ•°:
  å¾„å‘å±‚æ•°: [3]
  èµ·å§‹åŠå¾„ (mm): [0]
  åŠå¾„æ­¥é•¿ (mm): [10]
  
è§’åº¦èŒƒå›´:
  èµ·å§‹è§’åº¦ (Â°): [0]
  ç»“æŸè§’åº¦ (Â°): [360]
  
è§’åº¦åˆ†å¸ƒ:
  â—‹ å›ºå®šè§’åº¦æ­¥é•¿: [45] Â°
  â— å›ºå®šæ¯å±‚ç‚¹æ•°: [8] [æ¯å±‚ä¸åŒ]
  
[é¢„è§ˆå¸ƒç‚¹] [ç”Ÿæˆæµ‹ç‚¹]
```

**è¯´æ˜**ï¼š
- **åœ†å¿ƒåæ ‡**ï¼šå¯æ‰‹åŠ¨è¾“å…¥æˆ–ç‚¹å‡»é¢„è§ˆç”»å¸ƒè®¾ç½®
- **åŠå¾„æ­¥é•¿**ï¼šç›¸é‚»ä¸¤å±‚åœ†ç¯ä¹‹é—´çš„å¾„å‘è·ç¦»
- **è§’åº¦èŒƒå›´**ï¼šå†³å®šæ˜¯å®Œæ•´åœ†(360Â°)ã€åŠåœ†(180Â°)è¿˜æ˜¯æ‰‡å½¢
- **è§’åº¦åˆ†å¸ƒ**ï¼šä¸¤ç§æ¨¡å¼äºŒé€‰ä¸€
  - å›ºå®šè§’åº¦æ­¥é•¿ï¼šæ¯å±‚ç‚¹æ•°è‡ªåŠ¨è®¡ç®— = (ç»“æŸè§’åº¦ - èµ·å§‹è§’åº¦) / è§’åº¦æ­¥é•¿
  - å›ºå®šæ¯å±‚ç‚¹æ•°ï¼šè§’åº¦æ­¥é•¿è‡ªåŠ¨è®¡ç®— = (ç»“æŸè§’åº¦ - èµ·å§‹è§’åº¦) / ç‚¹æ•°

#### æ¯å±‚ä¸åŒç‚¹æ•°å¼¹çª—
ç‚¹å‡»"æ¯å±‚ä¸åŒ"æŒ‰é’®åå¼¹å‡ºè¾“å…¥æ¡†:

**æ¯å±‚ç‚¹æ•°è®¾ç½®**
```
æ¯å±‚ç‚¹æ•°é…ç½® (å…±3å±‚):
  ç¬¬1å±‚ç‚¹æ•°: [6]
  ç¬¬2å±‚ç‚¹æ•°: [8]
  ç¬¬3å±‚ç‚¹æ•°: [12]

æç¤º: é€šå¸¸å¤–å±‚ç‚¹æ•° â‰¥ å†…å±‚ç‚¹æ•°

[ç¡®å®š] [å–æ¶ˆ] [æ¢å¤ç»Ÿä¸€]
```

#### ç”Ÿæˆç®—æ³•
```python
def generate_polar_points(center_x, center_y, r_start, r_step, n_layers, 
                         start_angle, end_angle, 
                         angle_mode='fixed_points', angle_param=8):
    """ç”Ÿæˆæåæ ‡æµ‹ç‚¹ï¼ˆæ”¯æŒè§’åº¦èŒƒå›´å’Œä¸¤ç§è§’åº¦åˆ†å¸ƒæ¨¡å¼ï¼‰
    
    Args:
        center_x, center_y: åœ†å¿ƒåæ ‡
        r_start: èµ·å§‹åŠå¾„ (mm)
        r_step: åŠå¾„æ­¥é•¿ (mm)
        n_layers: å¾„å‘å±‚æ•°
        start_angle: èµ·å§‹è§’åº¦ (åº¦)
        end_angle: ç»“æŸè§’åº¦ (åº¦)
        angle_mode: è§’åº¦åˆ†å¸ƒæ¨¡å¼
            - 'fixed_step': å›ºå®šè§’åº¦æ­¥é•¿
            - 'fixed_points': å›ºå®šæ¯å±‚ç‚¹æ•°
        angle_param: è§’åº¦å‚æ•°
            - å½“ angle_mode='fixed_step' æ—¶ï¼Œä¸ºè§’åº¦æ­¥é•¿ (åº¦)
            - å½“ angle_mode='fixed_points' æ—¶ï¼Œä¸ºæ¯å±‚ç‚¹æ•°æˆ–ç‚¹æ•°æ•°ç»„
    
    Returns:
        list: æµ‹ç‚¹åˆ—è¡¨ [{"id": int, "x": float, "y": float, "r": float, "theta": float}, ...]
    """
    points = []
    index = 1
    
    # è®¡ç®—è§’åº¦èŒƒå›´
    angle_range = end_angle - start_angle
    
    # å¤„ç†æ¯å±‚ç‚¹æ•°
    if angle_mode == 'fixed_step':
        # å›ºå®šè§’åº¦æ­¥é•¿æ¨¡å¼ï¼šæ¯å±‚ç‚¹æ•°è‡ªåŠ¨è®¡ç®—
        angle_step = angle_param
        n_points_per_layer = int(angle_range / angle_step)
        points_per_layer = [n_points_per_layer] * n_layers
    else:
        # å›ºå®šæ¯å±‚ç‚¹æ•°æ¨¡å¼ï¼šè§’åº¦æ­¥é•¿è‡ªåŠ¨è®¡ç®—
        if isinstance(angle_param, int):
            # ç»Ÿä¸€ç‚¹æ•°
            points_per_layer = [angle_param] * n_layers
        else:
            # æ¯å±‚ä¸åŒç‚¹æ•°
            points_per_layer = angle_param
    
    # ç”Ÿæˆå„å±‚æµ‹ç‚¹
    for layer_idx in range(n_layers):
        # è®¡ç®—å½“å‰å±‚åŠå¾„
        radius = r_start + layer_idx * r_step
        
        # å½“å‰å±‚ç‚¹æ•°
        n_points = points_per_layer[layer_idx]
        
        # è®¡ç®—å½“å‰å±‚è§’åº¦æ­¥é•¿
        if n_points > 0:
            actual_angle_step = angle_range / n_points
        else:
            continue
        
        # ç”Ÿæˆå½“å‰å±‚çš„ç‚¹
        for point_idx in range(n_points):
            angle_deg = start_angle + point_idx * actual_angle_step
            angle_rad = np.radians(angle_deg)
            
            x = center_x + radius * np.cos(angle_rad)
            y = center_y + radius * np.sin(angle_rad)
            
            if is_point_valid(x, y, shape_config):
                points.append({
                    'id': index,
                    'x': round(x, 2),
                    'y': round(y, 2),
                    'r': round(radius, 2),
                    'theta': round(angle_deg % 360, 2)  # å½’ä¸€åŒ–åˆ° 0-360
                })
                index += 1
    
    return points
```

#### ç¤ºä¾‹æ•ˆæœ

**ç»Ÿä¸€ç‚¹æ•°**
```
åœ†ç›˜è¯•ä»¶ï¼Œ3å±‚ï¼Œæ¯å±‚8ç‚¹ï¼Œèµ·å§‹åŠå¾„0mmï¼Œæ­¥é•¿10mm

      â—
   â—  â—  â—
 â—    â—    â—
â—  â—  â—  â—  â—
 â—    â—    â—
   â—  â—  â—
      â—

ç”Ÿæˆ 24 ä¸ªæµ‹ç‚¹ï¼ˆ3å±‚ Ã— 8ç‚¹ï¼‰
```

**æ¯å±‚ä¸åŒç‚¹æ•°ï¼ˆå¤–å±‚åŠ å¯†ï¼‰**
```
åœ†ç›˜è¯•ä»¶ï¼Œ3å±‚ï¼Œç‚¹æ•° [6, 8, 12]
èµ·å§‹åŠå¾„0mmï¼Œæ­¥é•¿10mm

        â—
    â—   â—   â—
  â—   â—   â—   â—
 â—  â—  â—  â—  â—  â—
  â—   â—   â—   â—
    â—   â—   â—
        â—

ç”Ÿæˆ 26 ä¸ªæµ‹ç‚¹ï¼ˆ6 + 8 + 12ï¼‰
å¤–å±‚ç‚¹æ•°æ›´å¤šï¼Œè§’åº¦åˆ†è¾¨ç‡æ›´é«˜
```

### 5.3 å˜é—´è·å¸ƒç‚¹

#### å‚æ•°è®¾ç½®
```
å¸ƒç‚¹æ–¹å¼: [å˜é—´è·å¸ƒç‚¹ â–¼]

è¯•ä»¶å°ºå¯¸:
  å®½åº¦ (mm): [100]
  é«˜åº¦ (mm): [150]

å¯†é›†åŒºåŸŸ (åº”åŠ›é›†ä¸­):
  ä¸­å¿ƒ X (mm): [50]
  ä¸­å¿ƒ Y (mm): [30]
  å¯†é›†åŠå¾„ (mm): [20]
  å¯†é›†åŒºæµ‹ç‚¹æ•°: [16]

ç¨€ç–åŒºåŸŸ:
  å¤–å›´æµ‹ç‚¹æ•°: [12]
  
[é¢„è§ˆå¸ƒç‚¹] [ç”Ÿæˆæµ‹ç‚¹]
```

#### ç”Ÿæˆç®—æ³•
```python
def generate_adaptive_points(shape_config, dense_center, dense_radius, 
                            n_dense, n_sparse):
    """ç”Ÿæˆå˜é—´è·æµ‹ç‚¹"""
    points = []
    
    # å¯†é›†åŒºåŸŸï¼šå°ç½‘æ ¼
    dense_points = generate_grid_in_circle(
        dense_center, dense_radius, n_dense
    )
    
    # ç¨€ç–åŒºåŸŸï¼šå¤§ç½‘æ ¼ï¼ˆæ’é™¤å¯†é›†åŒºï¼‰
    sparse_points = generate_sparse_grid(
        shape_config, exclude_circle=(dense_center, dense_radius), 
        n_points=n_sparse
    )
    
    return dense_points + sparse_points
```

#### åº”ç”¨åœºæ™¯
- å­”æ´å‘¨å›´åº”åŠ›é›†ä¸­
- è£‚çº¹å°–ç«¯åŒºåŸŸ
- è½½è·ä½œç”¨ç‚¹é™„è¿‘
- è¾¹ç•Œæ•ˆåº”åŒºåŸŸ

### 5.4 è‡ªå®šä¹‰å¸ƒç‚¹

#### æ“ä½œæ–¹å¼
```
å¸ƒç‚¹æ–¹å¼: [è‡ªå®šä¹‰å¸ƒç‚¹ â–¼]

æ“ä½œæ–¹å¼:
  â— ç‚¹å‡»ç”»å¸ƒæ·»åŠ 
  â—‹ å¯¼å…¥åæ ‡æ–‡ä»¶

æµ‹ç‚¹åˆ—è¡¨:
  #1: (10.0, 10.0)  [åˆ é™¤] [ç¼–è¾‘]
  #2: (50.0, 50.0)  [åˆ é™¤] [ç¼–è¾‘]
  #3: (80.0, 30.0)  [åˆ é™¤] [ç¼–è¾‘]
  
[åœ¨ç”»å¸ƒä¸Šç‚¹å‡»æ·»åŠ ] [å¯¼å…¥ CSV] [æ¸…ç©º]
```

#### CSV å¯¼å…¥æ ¼å¼
```csv
x,y
10.0,10.0
50.0,50.0
80.0,30.0
```

#### äº¤äº’æ·»åŠ 
- åœ¨é¢„è§ˆç”»å¸ƒä¸Šç‚¹å‡» â†’ è‡ªåŠ¨æ·»åŠ æµ‹ç‚¹
- æ‹–æ‹½æµ‹ç‚¹ â†’ è°ƒæ•´ä½ç½®
- å³é”®ç‚¹å‡» â†’ åˆ é™¤æµ‹ç‚¹

### 5.5 æµ‹ç‚¹æ’åºä¼˜åŒ–

#### æ’åºç­–ç•¥
```python
def optimize_point_order(points, strategy='zigzag'):
    """ä¼˜åŒ–æµ‹ç‚¹é¡ºåºï¼Œå‡å°‘ç§»åŠ¨è·ç¦»"""
    if strategy == 'zigzag':
        # ä¹‹å­—å½¢æ‰«æ
        return zigzag_sort(points)
    elif strategy == 'nearest':
        # æœ€è¿‘é‚»ç®—æ³•ï¼ˆç±»ä¼¼TSPï¼‰
        return nearest_neighbor_sort(points)
    elif strategy == 'spiral':
        # èºæ—‹æ‰«æ
        return spiral_sort(points)
```

#### ç¤ºä¾‹ï¼šä¹‹å­—å½¢æ‰«æ
```
1â†’2â†’3â†’4â†’5
          â†“
10â†9â†8â†7â†6
â†“
11â†’12â†’13â†’14â†’15

å‡å°‘æ¢å¤´ç§»åŠ¨è·ç¦»ï¼Œæé«˜æ•ˆç‡
```

---

## 6. é‡‡é›†æµç¨‹

### 6.1 å·¥ä½œæµç¨‹å›¾

```
[å¼€å§‹] 
  â†“
[åŠ è½½æ ‡å®šæ•°æ®] â†’ é€‰æ‹©æ ‡å®šå®éªŒå’Œæ–¹å‘
  â†“
[å®šä¹‰è¯•ä»¶å½¢çŠ¶] â†’ çŸ©å½¢/åœ†å½¢/è‡ªå®šä¹‰
  â†“
[ç”Ÿæˆæµ‹ç‚¹å¸ƒå±€] â†’ ç½‘æ ¼/æåæ ‡/å˜é—´è·
  â†“
[è®¾ç½®åŸºå‡†æµ‹ç‚¹] â†’ é»˜è®¤ #1ï¼Œå¯ä¿®æ”¹
  â†“
[å¼€å§‹é‡‡é›†] â”€â”€â”€â”€â”
  â†“            â”‚
[ç§»åŠ¨æ¢å¤´åˆ°æµ‹ç‚¹ #N] â† ç”¨æˆ·æ‰‹åŠ¨æ“ä½œ
  â†“            â”‚
[é‡‡é›†æ³¢å½¢]     â”‚
  â†“            â”‚
[è®¡ç®—æ—¶é—´å·®]   â”‚
  â†“            â”‚
[è®¡ç®—åº”åŠ›å€¼]   â”‚
  â†“            â”‚
[ä¿å­˜æ•°æ®]     â”‚
  â†“            â”‚
[æ›´æ–°äº‘å›¾]     â”‚
  â†“            â”‚
[N < æ€»æ•°?] â”€â”€â”€â”˜ æ˜¯ â†’ ç»§ç»­ä¸‹ä¸€æµ‹ç‚¹
  â†“ å¦
[ç”Ÿæˆæœ€ç»ˆäº‘å›¾]
  â†“
[å¯¼å‡ºæŠ¥å‘Š]
  â†“
[ç»“æŸ]
```

### 6.2 çŠ¶æ€ç®¡ç†

#### æµ‹ç‚¹çŠ¶æ€
```python
class PointStatus:
    PENDING = 'pending'      # å¾…æµ‹
    MEASURING = 'measuring'  # æµ‹é‡ä¸­
    MEASURED = 'measured'    # å·²æµ‹
    SKIPPED = 'skipped'      # å·²è·³è¿‡
    ERROR = 'error'          # æµ‹é‡å¤±è´¥
```

#### å®éªŒçŠ¶æ€
```python
class ExperimentStatus:
    PLANNING = 'planning'    # è§„åˆ’é˜¶æ®µ
    READY = 'ready'          # å‡†å¤‡å°±ç»ª
    RUNNING = 'running'      # é‡‡é›†ä¸­
    PAUSED = 'paused'        # å·²æš‚åœ
    COMPLETED = 'completed'  # å·²å®Œæˆ
    ABORTED = 'aborted'      # å·²ä¸­æ­¢
```

### 6.3 é‡‡é›†æ§åˆ¶é€»è¾‘

#### å•ç‚¹é‡‡é›†æµç¨‹
```python
async def capture_single_point(point_id):
    """é‡‡é›†å•ä¸ªæµ‹ç‚¹"""
    try:
        # 1. æ›´æ–°çŠ¶æ€
        update_point_status(point_id, 'measuring')
        
        # 2. æç¤ºç”¨æˆ·ç§»åŠ¨æ¢å¤´
        show_message(f"è¯·å°†æ¢å¤´ç§»åŠ¨åˆ°æµ‹ç‚¹ #{point_id}")
        
        # 3. é‡‡é›†æ³¢å½¢
        waveform = await capture_waveform_from_scope()
        
        # 4. ä¸åŸºå‡†æ³¢å½¢äº’ç›¸å…³
        baseline = load_baseline_waveform()
        time_diff = calculate_cross_correlation(baseline, waveform)
        
        # 5. è®¡ç®—åº”åŠ›å€¼
        calibration = load_calibration_data()
        stress = calculate_stress(time_diff, calibration)
        
        # 6. ä¿å­˜æ•°æ®
        save_point_data(point_id, waveform, time_diff, stress)
        
        # 7. æ›´æ–°çŠ¶æ€
        update_point_status(point_id, 'measured')
        
        # 8. åˆ·æ–°äº‘å›¾
        update_contour_map()
        
        return {'success': True, 'stress': stress}
        
    except Exception as e:
        update_point_status(point_id, 'error')
        return {'success': False, 'error': str(e)}
```

#### è‡ªåŠ¨æ¨¡å¼
```python
async def auto_capture_mode():
    """è‡ªåŠ¨é‡‡é›†æ¨¡å¼"""
    for point in pending_points:
        # é‡‡é›†å½“å‰ç‚¹
        result = await capture_single_point(point.id)
        
        if result['success']:
            # è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æµ‹ç‚¹
            if auto_advance_enabled:
                await asyncio.sleep(1)  # çŸ­æš‚å»¶è¿Ÿ
                continue
            else:
                # ç­‰å¾…ç”¨æˆ·ç¡®è®¤
                await wait_for_user_confirmation()
        else:
            # å¼‚å¸¸å¤„ç†
            if auto_retry_enabled:
                result = await capture_single_point(point.id)
            else:
                # è¯¢é—®ç”¨æˆ·æ“ä½œ
                action = await ask_user_action()  # é‡è¯•/è·³è¿‡/ä¸­æ­¢
                if action == 'abort':
                    break
```

### 6.4 å¼‚å¸¸å¤„ç†

#### å¼‚å¸¸ç±»å‹
1. **ç¤ºæ³¢å™¨é€šä¿¡å¤±è´¥**ï¼šé‡è¯•3æ¬¡ï¼Œå¤±è´¥åæç¤ºç”¨æˆ·
2. **æ³¢å½¢è´¨é‡å·®**ï¼šä¿¡å™ªæ¯”è¿‡ä½ï¼Œå»ºè®®é‡æµ‹
3. **æ—¶é—´å·®å¼‚å¸¸**ï¼šè¶…å‡ºåˆç†èŒƒå›´ï¼Œæ ‡è®°ä¸ºå¯ç–‘æ•°æ®
4. **æ¢å¤´ä½ç½®é”™è¯¯**ï¼šç”¨æˆ·æ”¾é”™ä½ç½®ï¼Œå…è®¸é‡æµ‹

#### å¤„ç†ç­–ç•¥
```python
def handle_measurement_error(point_id, error_type):
    """å¤„ç†æµ‹é‡å¼‚å¸¸"""
    if error_type == 'communication_error':
        # é‡è¯•3æ¬¡
        for i in range(3):
            if retry_capture(point_id):
                return 'success'
        return 'failed'
    
    elif error_type == 'low_snr':
        # æç¤ºç”¨æˆ·æ£€æŸ¥æ¢å¤´è€¦åˆ
        show_warning("ä¿¡å·è´¨é‡å·®ï¼Œè¯·æ£€æŸ¥æ¢å¤´è€¦åˆ")
        return 'retry'
    
    elif error_type == 'abnormal_value':
        # æ ‡è®°ä¸ºå¯ç–‘ï¼Œå…è®¸ç»§ç»­
        mark_as_suspicious(point_id)
        return 'continue'
```

---

**ğŸ“„ æ–‡æ¡£è¯´æ˜**ï¼šæœ¬æ–‡æ¡£ä¸ºç¬¬2éƒ¨åˆ†ï¼ŒåŒ…å«ç¬¬4-6ç« å†…å®¹ã€‚  
**â¬…ï¸ ä¸Šä¸€éƒ¨åˆ†**ï¼š[å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£.md](./å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£.md)  
**â¡ï¸ ä¸‹ä¸€éƒ¨åˆ†**ï¼š[å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£-ç¬¬3éƒ¨åˆ†.md](./å•è½´åº”åŠ›æ£€æµ‹æ¨¡å—è®¾è®¡æ–‡æ¡£-ç¬¬3éƒ¨åˆ†.md)
