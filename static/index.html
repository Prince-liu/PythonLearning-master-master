<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超声波应力检测系统</title>
    <link rel="stylesheet" href="style.css">
    <!-- 应力模块样式（拆分后） -->
    <link rel="stylesheet" href="css/stress-calibration.css">
    <link rel="stylesheet" href="css/stress-common.css">
    <!-- 应力场测绘模块样式（按功能拆分） -->
    <link rel="stylesheet" href="css/stress-detection-uniaxial/layout.css">
    <link rel="stylesheet" href="css/stress-detection-uniaxial/panels.css">
    <link rel="stylesheet" href="css/stress-detection-uniaxial/capture.css">
    <link rel="stylesheet" href="css/stress-detection-uniaxial/display.css">
    <link rel="stylesheet" href="css/stress-detection-uniaxial/modals.css">
    <style>
        /* ========== 开屏画面容器（iframe 方式）========== */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99999;
            transition: opacity 0.5s ease-out;
        }
        
        #splashScreen.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- 开屏画面（iframe 独立加载）-->
    <div id="splashScreen">
        <iframe id="splashFrame" src="splash-oscilloscope.html" style="width:100%;height:100%;border:none;background:#0a0a0a;"></iframe>
    </div>
    
    <div class="container">
        <!-- 顶部标签栏 -->
        <div class="tab-bar">
            <button class="tab-btn active" data-tab="capture">📊 实时采集</button>
            <button class="tab-btn" data-tab="analysis">📈 波形分析</button>
            <button class="tab-btn" data-tab="calibration">🔬 应力系数标定</button>
            <button class="tab-btn" data-tab="detection">🔍 单轴应力检测</button>
        </div>

        <!-- 实时采集页面 -->
        <div id="captureTab" class="tab-content active">
        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 左侧配置面板 -->
            <div class="config-panel">
                <!-- 设备连接控制 -->
                <div class="device-controls">
                    <button id="searchBtn" class="btn btn-primary btn-device">🔍 搜索设备</button>
                    <button id="disconnectBtn" class="btn btn-danger btn-device" disabled>✕ 断开</button>
                </div>
                
                <div class="config-section">
                    <label class="config-label">可用设备</label>
                    <select id="deviceSelect" class="config-select">
                        <option value="">请先搜索设备</option>
                    </select>
                </div>

                <div class="config-section">
                    <h3 class="section-title">采集设置</h3>
                    
                    <label class="config-label">通道</label>
                    <select id="channelSelect" class="config-select">
                        <option value="1">通道 1</option>
                        <option value="2">通道 2</option>
                        <option value="3">通道 3</option>
                        <option value="4">通道 4</option>
                    </select>

                    <label class="config-label">存储深度</label>
                    <select id="memoryDepthSelect" class="config-select" disabled>
                        <option value="AUTO">AUTO（自动）</option>
                        <option value="1k">1k</option>
                        <option value="10k" selected>10k</option>
                        <option value="100k">100k</option>
                        <option value="1M">1M</option>
                        <option value="10M">10M</option>
                        <option value="25M">25M</option>
                        <option value="50M">50M</option>
                        <option value="100M">100M</option>
                        <option value="125M">125M</option>
                        <option value="200M">200M</option>
                        <option value="250M">250M</option>
                    </select>

                    <label class="config-label">时基（Time/Div）</label>
                    <select id="timebaseSelect" class="config-select" disabled>
                        <option value="10e-9">10 ns/div</option>
                        <option value="20e-9">20 ns/div</option>
                        <option value="50e-9">50 ns/div</option>
                        <option value="100e-9">100 ns/div</option>
                        <option value="200e-9">200 ns/div</option>
                        <option value="500e-9">500 ns/div</option>
                        <option value="1e-6">1 μs/div</option>
                        <option value="2e-6">2 μs/div</option>
                        <option value="5e-6" selected>5 μs/div</option>
                        <option value="10e-6">10 μs/div</option>
                        <option value="20e-6">20 μs/div</option>
                        <option value="50e-6">50 μs/div</option>
                        <option value="100e-6">100 μs/div</option>
                    </select>

                    <div class="button-group">
                        <button id="autoSetBtn" class="btn btn-secondary" disabled>自动</button>
                        <button id="runStopBtn" class="btn btn-secondary" disabled>▶ 运行</button>
                    </div>
                </div>

                <button id="captureBtn" class="btn btn-primary btn-large" disabled>
                    ⬇ 采集波形
                </button>
                
                <div class="btn-group">
                    <button id="saveBtn" class="btn btn-success btn-large" disabled>
                        📊 保存为 CSV
                    </button>
                    <button id="saveDropdownBtn" class="btn btn-success btn-dropdown" disabled>
                        ▼
                    </button>
                    <div id="saveDropdownMenu" class="dropdown-menu">
                        <div class="dropdown-item" data-format="npy">💾 保存为 NPY</div>
                        <div class="dropdown-item" data-format="csv">📊 保存为 CSV</div>
                    </div>
                </div>
            </div>

            <!-- 右侧波形显示区域 -->
            <div class="waveform-panel">
                <!-- 实时状态信息栏 -->
                <div class="waveform-status-bar">
                    <!-- 左侧：实时数据显示 -->
                    <div class="status-bar-left">
                        <div class="status-bar-item">
                            <span class="status-bar-label">通道:</span>
                            <span id="statusChannelValue" class="status-bar-value">CHAN1</span>
                        </div>
                        <div class="status-bar-item">
                            <span class="status-bar-label">采样率:</span>
                            <span id="sampleRateValue" class="status-bar-value">4.00 GSa/s</span>
                        </div>
                        <div class="status-bar-item">
                            <span class="status-bar-label">存储深度:</span>
                            <span id="memoryDepthValue" class="status-bar-value">10M</span>
                        </div>
                        <div class="status-bar-item">
                            <span class="status-bar-label">时基:</span>
                            <span id="timebaseValue" class="status-bar-value">50 ns/div</span>
                        </div>
                        <div class="status-bar-item">
                            <span class="status-bar-label">垂直档位:</span>
                            <span id="vScaleValue" class="status-bar-value">2.00 V/div (+1.0)</span>
                        </div>
                    </div>
                    
                    <!-- 右侧：信息显示区域 -->
                    <div id="statusBarInfoPanel" class="status-bar-info-panel" style="display: none;">
                        <div id="statusBarInfoIcon" class="status-bar-info-icon">✅</div>
                        <div class="status-bar-info-content">
                            <div id="statusBarInfoText" class="status-bar-info-text">操作成功</div>
                            <div id="statusBarInfoDetail" class="status-bar-info-detail">详细信息</div>
                        </div>
                    </div>
                </div>
                
                <!-- 波形显示主体：左边canvas + 右边垂直控制 -->
                <div class="waveform-display">
                    <div class="canvas-container">
                        <canvas id="waveformCanvas"></canvas>
                        <div id="statusMessage" class="status-message">请先搜索并连接设备</div>
                    </div>
                    

                </div>
                
                <!-- 水平控制条（底部） -->
                <div class="horizontal-controls">
                    <div class="h-control-group">
                        <button id="hLeftFastBtn" class="control-btn" title="快速左移">◀◀</button>
                        <button id="hLeftBtn" class="control-btn" title="左移">◀</button>
                        <button id="hCenterBtn" class="control-btn center-btn" title="水平回中">⊙ 回中</button>
                        <button id="hRightBtn" class="control-btn" title="右移">▶</button>
                        <button id="hRightFastBtn" class="control-btn" title="快速右移">▶▶</button>
                    </div>
                    <div class="v-scale-group">
                        <label>垂直灵敏度:</label>
                        <button id="vScaleDownBtn" class="control-btn" title="减小档位值">−</button>
                        <button id="vScaleUpBtn" class="control-btn" title="增大档位值">+</button>
                        <button id="vFineTuneBtn" class="control-btn" title="微调模式">微调</button>
                    </div>
                    <div class="reset-group">
                        <button id="vCenterBtn" class="control-btn center-btn" title="垂直居中">⊙ 垂直居中</button>
                        <button id="resetViewBtn" class="control-btn reset-btn" title="恢复默认视图">🔄 恢复默认</button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- 波形分析页面 -->
        <div id="analysisTab" class="tab-content">
            <!-- 顶部工具栏 -->
            <div class="analysis-toolbar">
                <button id="selectFileBtn" class="btn btn-primary">📂 选择文件</button>
                <span id="selectedFileName" class="file-name-display">未选择文件</span>
                
                <!-- 功能按钮 -->
                <div style="margin-left: auto; display: flex; gap: 10px;">
                    <button id="bandpassBtn" class="btn btn-secondary">🎛️ 带通滤波</button>
                    <button id="denoisingBtn" class="btn btn-secondary">🔊 小波降噪</button>
                    <button id="hilbertBtn" class="btn btn-secondary">📈 Hilbert变换</button>
                    <button id="timeDiffBtn" class="btn btn-secondary">⏱️ 时间差</button>
                    <button id="crossCorrBtn" class="btn btn-secondary">🔗 互相关</button>
                </div>
            </div>
            
            <!-- 主内容区域 -->
            <div id="analysisMainContainer" style="display: flex; flex: 1; overflow: hidden; gap: 10px;">
                <!-- 左侧配置面板 -->
                <div id="analysisSidebar" class="analysis-sidebar-left" style="display: none;">
                    <div class="sidebar-header">
                        <h3 id="sidebarTitle">配置</h3>
                        <button id="closeSidebarBtn" class="btn-close-sidebar" title="关闭侧边栏">×</button>
                    </div>
                    
                    <!-- 带通滤波面板 -->
                    <div id="bandpassPanel" class="analysis-panel" style="display: none;">
                        <div class="config-group">
                            <label>低频截止 (MHz): <span id="lowcutValue">1.5</span></label>
                            <input type="range" id="lowcutFreq" min="0.5" max="5.0" step="0.1" value="1.5" class="config-slider">
                        </div>
                        <div class="config-group">
                            <label>高频截止 (MHz): <span id="highcutValue">3.5</span></label>
                            <input type="range" id="highcutFreq" min="0.5" max="10.0" step="0.1" value="3.5" class="config-slider">
                        </div>
                        <div class="config-group">
                            <label>滤波器阶数</label>
                            <select id="filterOrder" class="config-input">
                                <option value="2">2阶</option>
                                <option value="4">4阶</option>
                                <option value="6" selected>6阶（推荐）</option>
                                <option value="8">8阶</option>
                            </select>
                        </div>
                        <button id="applyBandpassBtn" class="btn btn-primary btn-block">应用滤波</button>
                        <button id="toggleBandpassViewBtn" class="btn btn-secondary btn-block" disabled>切换视图</button>
                        <div id="bandpassResult" class="result-box" style="display: none;">
                            <p>低频: <span id="resultLowcut">--</span> MHz</p>
                            <p>高频: <span id="resultHighcut">--</span> MHz</p>
                            <p>阶数: <span id="resultOrder">--</span></p>
                        </div>
                    </div>
                    
                    <!-- 小波降噪面板 -->
                    <div id="denoisingPanel" class="analysis-panel" style="display: none;">
                        <div class="config-group">
                            <label>小波类型</label>
                            <select id="waveletType" class="config-input">
                                <option value="sym6">sym6</option>
                                <option value="db4">db4</option>
                                <option value="db5">db5</option>
                                <option value="coif2">coif2</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label>分解层数: <span id="decompLevelValue">5</span></label>
                            <input type="range" id="decompLevel" min="1" max="10" value="5" class="config-slider">
                        </div>
                        <div class="config-group">
                            <label>阈值方法</label>
                            <select id="thresholdMethod" class="config-input">
                                <option value="soft">软阈值</option>
                                <option value="hard">硬阈值</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label>阈值模式</label>
                            <select id="thresholdMode" class="config-input">
                                <option value="heursure">Heursure</option>
                                <option value="universal">Universal</option>
                                <option value="minimax">Minimax</option>
                            </select>
                        </div>
                        <button id="applyDenoiseBtn" class="btn btn-primary btn-block">应用降噪</button>
                        <button id="toggleViewBtn" class="btn btn-secondary btn-block" disabled>切换视图</button>
                        <div id="denoiseResult" class="result-box" style="display: none;">
                            <p>阈值: <span id="thresholdValue">--</span></p>
                            <p>噪声σ: <span id="sigmaValue">--</span></p>
                        </div>
                    </div>
                    
                    <!-- Hilbert变换面板 -->
                    <div id="hilbertPanel" class="analysis-panel" style="display: none;">
                        <div class="config-group">
                            <label>
                                <input type="checkbox" id="showOriginal" checked>
                                显示原始信号
                            </label>
                        </div>
                        <div class="config-group">
                            <label>包络线颜色</label>
                            <input type="color" id="envelopeColor" value="#ff6b6b" class="config-input">
                        </div>
                        <div class="config-group">
                            <label>线宽: <span id="widthValue">1</span></label>
                            <input type="range" id="envelopeWidth" min="1" max="5" value="1" class="config-slider">
                        </div>
                        <button id="applyHilbertBtn" class="btn btn-primary btn-block">应用Hilbert</button>
                        <button id="clearHilbertBtn" class="btn btn-secondary btn-block">清除包络</button>
                    </div>
                    
                    <!-- 时间差计算面板 -->
                    <div id="timeDiffPanel" class="analysis-panel" style="display: none;">
                        <div class="config-group">
                            <label>起始点设置</label>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <button id="useZeroBtn" class="btn btn-primary" style="flex: 1;">使用0点</button>
                                <button id="selectStartBtn" class="btn btn-secondary" style="flex: 1;">选择峰位</button>
                            </div>
                        </div>
                        
                        <div id="startPointInfo" class="info-box" style="margin-top: 10px;">
                            <p><strong>起始点:</strong> <span id="startPointValue">0.0000 μs</span></p>
                        </div>
                        
                        <p class="help-text">点击波形上的波峰位置来测量时间差</p>
                        
                        <button id="selectEndBtn" class="btn btn-success btn-block">点击选择波峰</button>
                        <button id="clearTimeDiffBtn" class="btn btn-secondary btn-block">清除标记</button>
                        
                        <div id="timeDiffResult" class="result-box" style="display: none;">
                            <p>起始点: <span id="peak1Time">--</span> μs</p>
                            <p>波峰位置: <span id="peak2Time">--</span> μs</p>
                            <p class="highlight">时间差: <span id="timeDiff">--</span> μs</p>
                        </div>
                    </div>
                    
                    <!-- 互相关面板 -->
                    <div id="crossCorrPanel" class="analysis-panel" style="display: none;">
                        <button id="selectMultipleFilesBtn" class="btn btn-primary btn-block">📂 选择CSV文件</button>
                        <div id="fileListDisplay" class="info-box" style="margin-top: 10px; display: none;">
                            <p><strong>已选择文件:</strong></p>
                            <div id="fileList" style="max-height: 60px; overflow-y: auto; font-size: 12px; line-height: 1.5;"></div>
                        </div>
                        <div class="config-group" id="referenceSelectGroup" style="display: none;">
                            <label>参考基准信号</label>
                            <select id="referenceSignalSelect" class="config-input">
                                <option value="">请选择参考信号</option>
                            </select>
                        </div>
                        
                        <!-- 🆕 信号处理配置面板 -->
                        <div class="config-group" id="signalProcessingConfigGroup" style="display: none;">
                            <label style="font-weight: 600; color: #374151; margin-bottom: 10px; display: block;">信号处理配置</label>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <label style="display: flex; align-items: center; gap: 6px; font-size: 13px; cursor: pointer;">
                                        <input type="checkbox" id="wa-denoise-checkbox">
                                        <span>自动降噪</span>
                                    </label>
                                    <button id="openSignalProcessingConfig" class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px;">⚙️</button>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <label style="display: flex; align-items: center; gap: 6px; font-size: 13px; cursor: pointer;">
                                        <input type="checkbox" id="wa-bandpass-checkbox">
                                        <span>带通滤波</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 信号截取范围 -->
                        <div class="config-group" id="truncateRangeGroup" style="display: none;">
                            <label>信号截取范围 (μs)</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <div style="flex: 1;">
                                    <label style="font-size: 11px; color: #666;">起始时间</label>
                                    <input type="number" id="truncateStartInput" class="config-input" value="" placeholder="不截取" step="0.1" style="margin-top: 2px;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 11px; color: #666;">结束时间</label>
                                    <input type="number" id="truncateEndInput" class="config-input" value="" placeholder="不截取" step="0.1" style="margin-top: 2px;">
                                </div>
                            </div>
                            <p style="font-size: 11px; color: #666; margin-top: 4px; margin-bottom: 0;">
                                💡 提示：留空表示不截取，输入0表示从0μs开始，支持负数时间
                            </p>
                        </div>
                        
                        <button id="calculateCrossCorr" class="btn btn-success btn-block" disabled>🔬 计算互相关</button>
                        <button id="exportCrossCorr" class="btn btn-secondary btn-block" disabled>💾 导出结果</button>
                        <div id="crossCorrStatus" class="info-box" style="margin-top: 10px; display: none;">
                            <p id="crossCorrStatusText">--</p>
                        </div>
                        
                        <!-- 互相关结果显示 -->
                        <div id="crossCorrResultsDisplay" style="margin-top: 15px; display: none;">
                            <h4 style="margin-bottom: 10px; color: #333;">📊 互相关结果</h4>
                            <div id="crossCorrResultsList" style="max-height: 300px; overflow-y: auto;">
                                <!-- 结果将动态插入这里 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 波形显示区域 -->
                <div id="analysisDisplayArea" class="analysis-display-full">
                    <div class="waveform-header">
                        <!-- 状态栏信息面板占位 -->
                        <div id="analysisStatusBarInfoPanel" class="status-bar-info-panel" style="display: none;">
                            <div id="analysisStatusBarInfoIcon" class="status-bar-info-icon">✅</div>
                            <div class="status-bar-info-content">
                                <div id="analysisStatusBarInfoText" class="status-bar-info-text">操作成功</div>
                                <div id="analysisStatusBarInfoDetail" class="status-bar-info-detail">详细信息</div>
                            </div>
                        </div>
                        
                        <!-- 工具栏按钮 -->
                        <div class="canvas-toolbar">
                            <button id="analysisScreenshotBtn" class="btn-icon" title="截图保存">📷</button>
                            <button id="analysisPanBtn" class="btn-icon" title="拖动模式 - 点击启用后拖动波形">✋</button>
                            <button id="analysisZoomInBtn" class="btn-icon" title="框选放大 - 点击启用后拖动鼠标选择区域">🔍+</button>
                            <button id="analysisFitBtn" class="btn-icon" title="适应窗口">⬜</button>
                            <button id="analysisResetBtn" class="btn-icon" title="重置 - 恢复原始视图">🏠</button>
                        </div>
                    </div>
                    <div class="canvas-container" style="position: relative;">
                        <canvas id="analysisCanvas"></canvas>
                        <!-- 图例 -->
                        <div id="analysisLegend" class="canvas-legend" style="display: none;">
                            <div class="legend-item">
                                <span class="legend-line" style="background: #2563eb;"></span>
                                <span class="legend-text">原始信号</span>
                            </div>
                        </div>
                        <div id="analysisStatusMessage" class="status-message">请选择波形文件</div>
                    </div>
                </div>
                


            </div>
        </div>

        <!-- 应力系数标定实验页面 -->
        <div id="calibrationTab" class="tab-content">
            <div class="stress-detection-container">
                <!-- 左侧控制面板 -->
                <div class="stress-control-panel">
                    <!-- 实验信息 -->
                    <div class="config-section">
                        <h4 class="section-title">📋 实验信息</h4>
                        <label class="config-label">材料名称</label>
                        <input type="text" id="sd-materialName" class="config-input" placeholder="例如: 碳纤维复合材料板">
                        
                        <label class="config-label">测试方向</label>
                        <div style="display: flex; gap: 5px;">
                            <button id="sd-addDirectionBtn" class="btn btn-primary" style="flex: 1;">+ 添加方向</button>
                            <button id="sd-manageExperimentsBtn" class="btn btn-secondary" style="flex: 1;">📂 实验管理</button>
                        </div>
                        
                        <!-- 🆕 方向标签页 -->
                        <div id="sd-directionTabs" class="direction-tabs" style="display: none;">
                            <!-- 方向标签将动态插入这里 -->
                        </div>
                    </div>
                    
                    <!-- 实验参数 -->
                    <div class="config-section">
                        <h4 class="section-title" id="sd-paramTitle">⚙️ 实验参数</h4>
                        <label class="config-label">应力范围 (MPa)</label>
                        <div class="input-group">
                            <input type="number" id="sd-stressMin" class="config-input-small" value="0" min="0">
                            <span>-</span>
                            <input type="number" id="sd-stressMax" class="config-input-small" value="100" min="0">
                        </div>
                        
                        <label class="config-label">应力步长 (MPa)</label>
                        <input type="number" id="sd-stressStep" class="config-input" value="10" min="1">
                        
                        <button id="sd-toggleExperimentBtn" class="btn btn-primary btn-block">▶️ 开始实验</button>
                        
                        <!-- 信号处理选项 -->
                        <div class="field-capture-options" style="margin-top: 8px;">
                            <label><input type="checkbox" id="sd-auto-denoise" checked> 自动降噪</label>
                            <button id="sd-denoise-settings" class="btn btn-sm">⚙️</button>
                        </div>
                        <div class="field-capture-options">
                            <label><input type="checkbox" id="sd-bandpass-filter" checked> 带通滤波</label>
                        </div>
                    </div>
                    
                    <!-- 数据采集 -->
                    <div class="config-section">
                        <h4 class="section-title" id="sd-captureTitle">📸 数据采集</h4>
                        <button id="sd-captureBaselineBtn" class="btn btn-primary btn-block" disabled>采集基准波形</button>
                        
                        <label class="config-label">当前应力点 (MPa)</label>
                        <div class="stress-input-wrapper">
                            <input type="number" id="sd-currentStress" class="config-input" value="0" min="0">
                            <span id="sd-recaptureTag" class="recapture-tag" style="display: none;">(重测)</span>
                        </div>
                        
                        <button id="sd-captureWaveformBtn" class="btn btn-success btn-block" disabled>采集波形</button>
                        <button id="sd-endCaptureBtn" class="btn btn-secondary btn-block" disabled>采集结束</button>
                        <button id="sd-resetExperimentBtn" class="btn btn-danger btn-block" disabled>🔄 重置实验</button>
                    </div>
                    
                    <!-- 数据分析 -->
                    <div class="config-section">
                        <h4 class="section-title" id="sd-analysisTitle">📊 数据分析</h4>
                        <button id="sd-exportDataBtn" class="btn btn-secondary btn-block" disabled>导出数据</button>
                    </div>
                </div>
                
                <!-- 右侧显示区域 -->
                <div class="stress-display-area">
                    <!-- 实时波形监控 -->
                    <div class="stress-monitor-section">
                        <div class="waveform-header">
                            <!-- 左侧：信息显示面板 -->
                            <div id="sd-statusBarInfoPanel" class="status-bar-info-panel" style="display: none;">
                                <div id="sd-statusBarInfoIcon" class="status-bar-info-icon">✅</div>
                                <div class="status-bar-info-content">
                                    <div id="sd-statusBarInfoText" class="status-bar-info-text">操作成功</div>
                                    <div id="sd-statusBarInfoDetail" class="status-bar-info-detail">详细信息</div>
                                </div>
                            </div>
                            
                            <!-- 右侧：监控控制 -->
                            <div style="display: flex; gap: 10px; align-items: center; margin-left: auto;">
                                <button id="sd-startMonitorBtn" class="btn-monitor-compact" title="开始监控">▶️</button>
                                <button id="sd-stopMonitorBtn" class="btn-monitor-compact btn-monitor-stop" title="停止监控" style="display: none;">⏸️</button>
                                <span id="sd-monitorStatus" class="monitor-status">未监控</span>
                            </div>
                        </div>
                        <div class="canvas-container">
                            <canvas id="sd-monitorCanvas"></canvas>
                            <div id="sd-monitorMessage" class="status-message">点击"▶️"开始监控</div>
                        </div>
                    </div>
                    
                    <!-- 下方区域：数据表格 + 拟合曲线 -->
                    <div class="stress-bottom-section">
                        <!-- 数据表格 -->
                        <div class="stress-data-table">
                            <div class="table-header">
                                <span id="sd-tableTitle">测试方向: --</span>
                            </div>
                            <div class="table-container">
                                <table id="sd-dataTable">
                                    <thead>
                                        <tr>
                                            <th>应力值 (MPa)</th>
                                            <th>声时差 (ns)</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sd-dataTableBody">
                                        <tr>
                                            <td colspan="3" class="empty-message">暂无数据</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 拟合曲线图 -->
                        <div class="stress-fit-curve">
                            <div class="curve-header">
                                <span>拟合曲线</span>
                                <span id="sd-fitEquation" class="fit-equation">Δt = -- σ + --</span>
                            </div>
                            <div class="canvas-container">
                                <canvas id="sd-fitCanvas"></canvas>
                                <div id="sd-fitMessage" class="status-message">请先采集数据</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 单轴应力检测页面 - 应力场测绘 -->
        <div id="detectionTab" class="tab-content">
            <div class="field-mapping-container">
                <!-- 左侧控制栏 -->
                <div class="field-control-panel">
                    <!-- 实验管理区（固定） -->
                    <div class="field-experiment-section">
                        <div class="field-experiment-header">
                            <span id="field-experiment-name">未加载实验</span>
                            <span id="field-experiment-status" class="field-status-badge">--</span>
                        </div>
                        <div class="field-experiment-info">
                            <span>材料: <span id="field-sample-material">--</span></span>
                            <span>方向: <span id="field-stress-direction">--</span></span>
                            <span>楔块: <span id="field-wedge-angle">--</span>°</span>
                            <span id="field-autosave-status"></span>
                        </div>
                        <div class="field-experiment-buttons">
                            <button id="field-new-experiment-btn" class="btn btn-primary btn-sm">📋 新建</button>
                            <button id="field-manage-experiments-btn" class="btn btn-secondary btn-sm">📁 管理</button>
                            <button id="field-reset-experiment-btn" class="btn btn-danger btn-sm" disabled>🔄 重置</button>
                        </div>
                    </div>
                    
                    <!-- 折叠面板区域 -->
                    <div class="field-panels-container">
                        <!-- 1. 标定数据面板 -->
                        <div class="field-panel" id="field-calibration-panel">
                            <div class="field-panel-header">
                                <span>📐 标定数据</span>
                                <span id="field-calib-status" class="status-badge">⚪ 未加载</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-radio-group">
                                    <label><input type="radio" name="field-calib-source" value="local" checked> 本地实验</label>
                                    <label><input type="radio" name="field-calib-source" value="manual"> 手动输入</label>
                                </div>
                                <div id="field-calib-local-panel" class="field-calib-source-panel">
                                    <button id="field-calib-load-local" class="btn btn-primary btn-block btn-sm">选择标定实验</button>
                                </div>
                                <div id="field-calib-manual-panel" class="field-calib-source-panel" style="display:none;">
                                    <div class="form-group">
                                        <label>应力系数 K (MPa/ns)</label>
                                        <input type="number" id="field-calib-manual-k" class="form-control" step="0.01" placeholder="例如: 2.0">
                                    </div>
                                    <button id="field-calib-confirm-manual" class="btn btn-primary btn-block btn-sm">确认</button>
                                </div>
                                <div id="field-calib-info" class="field-info-box"></div>
                            </div>
                        </div>
                        
                        <!-- 2. 形状定义面板 -->
                        <div class="field-panel" id="field-shape-panel">
                            <div class="field-panel-header">
                                <span>📐 试件形状</span>
                                <span id="field-shape-status" class="status-badge">⚪ 未设置</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-radio-group">
                                    <label><input type="radio" name="field-shape-type" value="rectangle" checked> 矩形</label>
                                    <label><input type="radio" name="field-shape-type" value="circle"> 圆形</label>
                                    <label><input type="radio" name="field-shape-type" value="polygon"> 多边形</label>
                                </div>
                                <!-- 矩形参数 -->
                                <div id="field-shape-rectangle-params" class="field-shape-params">
                                    <div class="form-row">
                                        <div class="form-group"><label>宽度(mm)</label><input type="number" id="field-shape-rect-width" class="form-control field-shape-param" value="100"></div>
                                        <div class="form-group"><label>高度(mm)</label><input type="number" id="field-shape-rect-height" class="form-control field-shape-param" value="100"></div>
                                    </div>
                                </div>
                                <!-- 圆形参数 -->
                                <div id="field-shape-circle-params" class="field-shape-params" style="display:none;">
                                    <div class="form-row">
                                        <div class="form-group"><label>圆心X</label><input type="number" id="field-shape-circle-cx" class="form-control field-shape-param" value="50"></div>
                                        <div class="form-group"><label>圆心Y</label><input type="number" id="field-shape-circle-cy" class="form-control field-shape-param" value="50"></div>
                                    </div>
                                    <div class="form-group"><label>半径(mm)</label><input type="number" id="field-shape-circle-radius" class="form-control field-shape-param" value="50"></div>
                                </div>
                                <!-- 多边形参数 -->
                                <div id="field-shape-polygon-params" class="field-shape-params" style="display:none;">
                                    <div class="form-group">
                                        <label>顶点坐标 (每行一个: x,y)</label>
                                        <textarea id="field-shape-polygon-vertices" class="form-control field-shape-param" rows="4" placeholder="0,0&#10;100,0&#10;100,100&#10;0,100"></textarea>
                                    </div>
                                </div>
                                <!-- 布尔运算 -->
                                <div class="field-modifiers-section">
                                    <div class="field-modifiers-header">
                                        <span>孔洞/缺口</span>
                                        <button id="field-shape-add-hole" class="btn btn-sm">+ 添加</button>
                                    </div>
                                    <div id="field-shape-modifiers" class="field-modifiers-list"><div class="empty">无孔洞/缺口</div></div>
                                </div>
                                <div class="field-panel-actions">
                                    <button id="field-shape-validate" class="btn btn-secondary btn-sm">验证</button>
                                    <button id="field-shape-apply" class="btn btn-primary btn-sm">应用</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 3. 布点设置面板 -->
                        <div class="field-panel" id="field-layout-panel">
                            <div class="field-panel-header">
                                <span>📍 测点布局</span>
                                <span id="field-layout-status" class="status-badge">⚪ 未生成</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-radio-group">
                                    <label><input type="radio" name="field-layout-type" value="grid" checked> 网格</label>
                                    <label><input type="radio" name="field-layout-type" value="polar"> 极坐标</label>
                                    <label><input type="radio" name="field-layout-type" value="custom"> 自定义</label>
                                </div>
                                <!-- 网格参数 -->
                                <div id="field-layout-grid-params" class="field-layout-params">
                                    <div class="form-row">
                                        <div class="form-group"><label>行数</label><input type="number" id="field-layout-grid-rows" class="form-control" value="5" min="1"></div>
                                        <div class="form-group"><label>列数</label><input type="number" id="field-layout-grid-cols" class="form-control" value="5" min="1"></div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>行间距(mm)</label>
                                            <div class="field-margin-display">
                                                <span id="field-layout-row-spacing-display">--</span>
                                                <button type="button" id="field-layout-row-spacing-btn" class="btn btn-secondary btn-xs">变距</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>列间距(mm)</label>
                                            <div class="field-margin-display">
                                                <span id="field-layout-col-spacing-display">--</span>
                                                <button type="button" id="field-layout-col-spacing-btn" class="btn btn-secondary btn-xs">变距</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>边距(mm)</label>
                                        <div class="field-margin-display">
                                            <span id="field-layout-margin-display">统一: 10</span>
                                            <button type="button" id="field-layout-margin-btn" class="btn btn-secondary btn-xs">设置</button>
                                        </div>
                                    </div>
                                    <!-- 隐藏的边距值存储 -->
                                    <input type="hidden" id="field-layout-grid-margin-top" value="10">
                                    <input type="hidden" id="field-layout-grid-margin-bottom" value="10">
                                    <input type="hidden" id="field-layout-grid-margin-left" value="10">
                                    <input type="hidden" id="field-layout-grid-margin-right" value="10">
                                    <input type="hidden" id="field-layout-margin-mode" value="uniform">
                                    <!-- 隐藏的间距值存储 -->
                                    <input type="hidden" id="field-layout-row-spacing-mode" value="uniform">
                                    <input type="hidden" id="field-layout-row-spacing-value" value="10">
                                    <input type="hidden" id="field-layout-row-spacing-array" value="">
                                    <input type="hidden" id="field-layout-col-spacing-mode" value="uniform">
                                    <input type="hidden" id="field-layout-col-spacing-value" value="10">
                                    <input type="hidden" id="field-layout-col-spacing-array" value="">
                                </div>
                                <!-- 极坐标参数 -->
                                <div id="field-layout-polar-params" class="field-layout-params" style="display:none;">
                                    <div class="form-row">
                                        <div class="form-group"><label>圆心X</label><input type="number" id="field-layout-polar-cx" class="form-control" value="50"></div>
                                        <div class="form-group"><label>圆心Y</label><input type="number" id="field-layout-polar-cy" class="form-control" value="50"></div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label>起始半径</label><input type="number" id="field-layout-polar-rstart" class="form-control" value="0" min="0"></div>
                                        <div class="form-group">
                                            <label>半径步长</label>
                                            <div style="display:flex;gap:5px;">
                                                <input type="number" id="field-layout-polar-rstep" class="form-control" value="10" min="1">
                                                <button id="field-layout-polar-rstep-btn" class="btn btn-secondary btn-sm" title="每层不同半径步长">变</button>
                                            </div>
                                            <input type="hidden" id="field-layout-polar-rstep-mode" value="uniform">
                                            <input type="hidden" id="field-layout-polar-rstep-array" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label>层数</label><input type="number" id="field-layout-polar-rcount" class="form-control" value="4" min="1"></div>
                                        <div class="form-group">
                                            <label>每层点数</label>
                                            <div style="display:flex;gap:5px;">
                                                <input type="number" id="field-layout-polar-ppr" class="form-control" value="8" min="1">
                                                <button id="field-layout-polar-ppr-btn" class="btn btn-secondary btn-sm" title="每层不同点数">变</button>
                                            </div>
                                            <input type="hidden" id="field-layout-polar-ppr-mode" value="uniform">
                                            <input type="hidden" id="field-layout-polar-ppr-array" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label>起始角度</label><input type="number" id="field-layout-polar-astart" class="form-control" value="0"></div>
                                        <div class="form-group"><label>结束角度</label><input type="number" id="field-layout-polar-aend" class="form-control" value="360"></div>
                                    </div>
                                </div>
                                <!-- 自定义参数 -->
                                <div id="field-layout-custom-params" class="field-layout-params" style="display:none;">
                                    <button id="field-layout-import" class="btn btn-primary btn-block btn-sm">📂 导入CSV</button>
                                </div>
                                <div class="field-panel-actions">
                                    <button id="field-layout-generate" class="btn btn-primary btn-sm">生成测点</button>
                                    <button id="field-layout-optimize" class="btn btn-secondary btn-sm">优化顺序</button>
                                    <button id="field-layout-clear" class="btn btn-danger btn-sm">清空</button>
                                </div>
                                <div class="field-layout-info">测点数: <span id="field-layout-count">0</span></div>
                            </div>
                        </div>
                        
                        <!-- 4. 基准波形管理面板 -->
                        <div class="field-panel" id="field-baseline-panel">
                            <div class="field-panel-header">
                                <span>📊 基准波形管理</span>
                                <span id="field-baseline-status" class="status-badge">⚪ 未设置</span>
                            </div>
                            <div class="field-panel-body">
                                <!-- 基准点设置区域 -->
                                <div class="field-baseline-setting">
                                    <div class="field-baseline-input-row">
                                        <label class="field-input-label">基准测点:</label>
                                        <input type="number" id="field-baseline-point-input" value="1" min="1" step="1" class="field-baseline-input">
                                        <button id="field-baseline-set-btn" class="btn btn-primary btn-sm">📌 设置基准</button>
                                    </div>
                                    <div class="field-baseline-hint">
                                        <small style="color: #888;">💡 提示：开始采集时会自动采集基准点</small>
                                    </div>
                                </div>
                                
                                <!-- 基准点信息显示 -->
                                <div class="field-baseline-info">
                                    <div class="field-info-item">
                                        <span class="label">当前基准点:</span>
                                        <span id="field-baseline-point-id" class="value">--</span>
                                    </div>
                                    <div class="field-info-item">
                                        <span class="label">采集状态:</span>
                                        <span id="field-baseline-capture-status" class="value">⚪ 未采集</span>
                                    </div>
                                    <div class="field-info-item">
                                        <span class="label">信噪比:</span>
                                        <span id="field-baseline-snr" class="value">--</span>
                                    </div>
                                    <div class="field-info-item">
                                        <span class="label">质量评分:</span>
                                        <span id="field-baseline-quality" class="value">--</span>
                                    </div>
                                </div>
                                
                                <!-- 应力计算模式 -->
                                <div class="field-stress-mode-section">
                                    <div class="section-divider"></div>
                                    <div class="field-stress-mode-title">应力计算模式:</div>
                                    <div class="field-stress-mode-options">
                                        <label class="field-radio-option">
                                            <input type="radio" name="field-stress-mode" value="relative" checked>
                                            <span class="radio-label">相对应力模式（基准点 = 0 MPa）</span>
                                        </label>
                                        <label class="field-radio-option">
                                            <input type="radio" name="field-stress-mode" value="absolute">
                                            <span class="radio-label">绝对应力模式</span>
                                        </label>
                                    </div>
                                    <div id="field-absolute-stress-input" class="field-absolute-stress-input" style="display: none;">
                                        <label class="field-input-label">
                                            基准点应力值 (MPa):
                                            <input type="number" id="field-baseline-stress-value" value="0" step="0.1">
                                        </label>
                                        <div class="field-input-hint">💡 正值=拉应力，负值=压应力</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 5. 质量检查模式面板 -->
                        <div class="field-panel" id="field-quality-panel">
                            <div class="field-panel-header">
                                <span>🔍 质量检查模式</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-quality-mode-selector">
                                    <div class="field-quality-mode-card selected" data-mode="strict">
                                        <div class="mode-icon">🔍</div>
                                        <div class="mode-title">严格模式</div>
                                        <div class="mode-desc">精细测量</div>
                                    </div>
                                    <div class="field-quality-mode-card" data-mode="fast">
                                        <div class="mode-icon">⚡</div>
                                        <div class="mode-title">快速模式</div>
                                        <div class="mode-desc">粗略测量</div>
                                    </div>
                                </div>
                                <div id="field-quality-features-strict" class="field-quality-features">
                                    <div class="feature-item"><span class="check">✓</span> 实时质量评估</div>
                                    <div class="feature-item"><span class="check">✓</span> 质量不合格时弹出警告</div>
                                    <div class="feature-item"><span class="check">✓</span> 可选择重测或跳过</div>
                                </div>
                                <div id="field-quality-features-fast" class="field-quality-features" style="display: none;">
                                    <div class="feature-item"><span class="check">✓</span> 实时质量评估</div>
                                    <div class="feature-item"><span class="check">✓</span> 仅显示简短提示</div>
                                    <div class="feature-item"><span class="check">✓</span> 自动继续下一测点</div>
                                </div>
                                <div id="field-quality-mode-desc" class="field-quality-mode-description">
                                    适合正式实验和高精度测量
                                </div>
                            </div>
                        </div>
                        
                        <!-- 6. 采集控制面板 -->
                        <div class="field-panel" id="field-capture-panel">
                            <div class="field-panel-header">
                                <span>📸 数据采集</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-capture-global-controls">
                                    <button id="field-capture-start-pause" class="btn btn-primary">▶️ 开始采集</button>
                                    <button id="field-capture-finish" class="btn btn-secondary">✅ 完成采集</button>
                                </div>
                                <div class="field-progress-bar-container">
                                    <div id="field-capture-progress-bar" class="field-progress-bar"></div>
                                </div>
                                <div class="field-current-point">
                                    <div class="field-point-info">
                                        <span>当前测点: <strong id="field-capture-point-id">--</strong> <span id="field-capture-point-type"></span></span>
                                        <span>位置: (<span id="field-capture-point-x">--</span>, <span id="field-capture-point-y">--</span>)</span>
                                    </div>
                                    <div class="field-point-nav">
                                        <button id="field-capture-prev" class="btn btn-sm">◀</button>
                                        <input type="number" id="field-capture-jump-input" class="point-jump-input" min="1" value="0" />
                                        <span> / </span>
                                        <span id="field-capture-total">0</span>
                                        <button id="field-capture-next" class="btn btn-sm">▶</button>
                                        <button id="field-capture-jump-btn" class="btn btn-sm" title="跳转到指定测点">🔍</button>
                                    </div>
                                </div>
                                <div class="field-capture-actions">
                                    <button id="field-capture-current" class="btn btn-primary btn-block" disabled>📸 采集当前测点</button>
                                    <div class="field-capture-secondary">
                                        <button id="field-capture-skip" class="btn btn-secondary btn-sm" disabled>跳过</button>
                                        <button id="field-capture-recapture" class="btn btn-secondary btn-sm" disabled>重测</button>
                                    </div>
                                </div>
                                <div class="field-capture-options">
                                    <label><input type="checkbox" id="field-capture-auto-denoise" checked> 自动降噪</label>
                                    <button id="field-capture-denoise-settings" class="btn btn-sm">⚙️</button>
                                </div>
                                <div class="field-capture-options">
                                    <label><input type="checkbox" id="field-capture-bandpass-filter" checked> 带通滤波</label>
                                </div>
                                <div class="field-capture-result">
                                    <div class="result-item"><span>时间差:</span><span id="field-capture-result-timediff">--</span> ns</div>
                                    <div class="result-item"><span>应力:</span><span id="field-capture-result-stress">--</span> MPa</div>
                                    <div class="result-item"><span>质量:</span><span id="field-capture-result-quality">--</span></div>
                                    <div class="result-item"><span>SNR:</span><span id="field-capture-result-snr">--</span> dB</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 7. 云图设置面板 -->
                        <div class="field-panel" id="field-contour-settings-panel">
                            <div class="field-panel-header">
                                <span>🗺️ 云图设置</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-form-group">
                                    <label>插值方法</label>
                                    <select id="field-contour-interpolation" class="field-select">
                                        <option value="auto">自动选择</option>
                                        <option value="linear">线性插值</option>
                                        <option value="cubic">三次插值</option>
                                    </select>
                                </div>
                                <div class="field-form-group">
                                    <label>分辨率</label>
                                    <select id="field-contour-resolution" class="field-select">
                                        <option value="100" selected>低 (100×100)</option>
                                        <option value="200">中 (200×200)</option>
                                        <option value="300">高 (300×300)</option>
                                    </select>
                                </div>
                                <div class="field-form-group">
                                    <label>
                                        <input type="checkbox" id="field-contour-smoothing" checked>
                                        高斯平滑
                                    </label>
                                </div>
                                <div class="field-form-group">
                                    <label>色标样式</label>
                                    <div class="field-colormap-row">
                                        <select id="field-contour-colormap" class="field-select">
                                            <option value="jet" selected>Jet (经典彩虹)</option>
                                            <option value="turbo">Turbo (现代彩虹)</option>
                                            <option value="plasma">Plasma (等离子)</option>
                                            <option value="rainbow">Rainbow (标准光谱)</option>
                                        </select>
                                        <canvas id="field-colormap-preview" class="field-colormap-preview"></canvas>
                                    </div>
                                </div>
                                <div class="field-checkbox-group">
                                    <label><input type="checkbox" id="field-contour-show-points" checked> 显示测点</label>
                                    <label><input type="checkbox" id="field-contour-show-contour-lines"> 显示等高线</label>
                                    <label><input type="checkbox" id="field-contour-show-tooltip"> 悬停显示应力值</label>
                                </div>
                                <div class="field-panel-actions">
                                    <button id="field-contour-refresh" class="btn btn-primary btn-sm">🔄 刷新云图</button>
                                    <button id="field-contour-export" class="btn btn-secondary btn-sm">📷 导出图片</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 8. 数据导出面板 -->
                        <div class="field-panel" id="field-export-panel">
                            <div class="field-panel-header">
                                <span>📤 数据导出</span>
                            </div>
                            <div class="field-panel-body">
                                <div class="field-form-group">
                                    <label>导出格式</label>
                                    <select id="field-export-format" class="field-select">
                                        <option value="csv">CSV (测点数据)</option>
                                        <option value="excel">Excel (完整报告)</option>
                                        <option value="hdf5">HDF5 (可含波形)</option>
                                    </select>
                                </div>
                                
                                <!-- Excel格式选项 -->
                                <div class="field-form-group" id="field-export-excel-options" style="display: none;">
                                    <label>Excel格式</label>
                                    <div class="field-radio-group">
                                        <label><input type="radio" name="excel-format" value="multi" checked> 多表格式（推荐）</label>
                                        <label><input type="radio" name="excel-format" value="single"> 单表格式</label>
                                    </div>
                                    <small style="color: #666; display: block; margin-top: 4px;">
                                        多表：分为实验信息、测点数据、统计信息三个工作表<br>
                                        单表：所有数据在一个工作表中
                                    </small>
                                </div>
                                
                                <!-- HDF5格式选项 -->
                                <div class="field-form-group" id="field-export-hdf5-options" style="display: none;">
                                    <label>HDF5选项</label>
                                    <div class="field-checkbox-group">
                                        <label><input type="checkbox" id="field-export-include-waveforms"> 包含波形数据</label>
                                    </div>
                                    <small style="color: #666; display: block; margin-top: 4px;">
                                        💡 勾选后文件会包含所有测点的完整波形数据（约 1-2 MB）
                                    </small>
                                </div>
                                
                                <div class="field-checkbox-group">
                                    <label><input type="checkbox" id="field-export-include-contour" checked> 包含云图</label>
                                </div>
                                <div class="field-panel-actions">
                                    <button id="field-export-btn" class="btn btn-primary btn-block btn-sm">📥 导出数据</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 右侧显示区 -->
                <div class="field-display-area">
                    <!-- 上半区：数据表格 + 波形 -->
                    <div class="field-top-section">
                        <!-- 数据表格 -->
                        <div class="field-data-table-container">
                            <div class="field-table-header">
                                <span>📊 测点数据</span>
                                <div class="field-table-actions">
                                    <button class="btn btn-sm" onclick="(async function() {
                                        const exp = StressDetectionUniaxialModule.获取当前实验();
                                        if (!exp) { StressDetectionUniaxialModule.显示状态信息('⚠️', '请先加载实验', '', 'warning'); return; }
                                        StressDetectionUniaxialModule.显示状态信息('⏳', '正在导出CSV...', '', 'info', 0);
                                        const result = await pywebview.api.export_field_data(exp.experiment_id, 'csv', {include_waveforms: false});
                                        if (result.success) StressDetectionUniaxialModule.显示状态信息('✅', 'CSV已导出', '', 'success', 3000);
                                        else StressDetectionUniaxialModule.显示状态信息('❌', '导出失败', result.message, 'error');
                                    })()" title="快速导出表格为CSV">📥 导出CSV</button>
                                </div>
                            </div>
                            <div class="field-table-wrapper">
                                <table id="field-data-table">
                                    <thead>
                                        <tr>
                                            <th>编号</th>
                                            <th>X(mm)</th>
                                            <th>Y(mm)</th>
                                            <th>Δt(ns)</th>
                                            <th>σ(MPa)</th>
                                            <th>质量</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="field-data-table-body">
                                        <tr><td colspan="7" style="text-align:center;color:#999;">暂无测点数据</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- 波形显示 -->
                        <div class="field-waveform-container">
                            <div class="field-waveform-header">
                                <span>实时波形</span>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <button id="field-waveform-start" class="btn-monitor-compact" title="开始监控">▶️</button>
                                    <button id="field-waveform-stop" class="btn-monitor-compact btn-monitor-stop" title="停止监控" style="display: none;">⏸️</button>
                                    <span id="field-waveform-status" class="monitor-status">未监控</span>
                                </div>
                            </div>
                            <canvas id="field-waveform-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- 上下拖拽分割条 -->
                    <div class="field-resize-handle field-resize-vertical" id="field-resize-vertical"></div>
                    
                    <!-- 下半区：预览画布 + 云图 -->
                    <div class="field-bottom-section">
                        <!-- 预览画布 -->
                        <div class="field-preview-container" id="field-preview-container">
                            <div class="field-canvas-header field-collapsible-header" data-target="preview">
                                <span>📐 测点预览</span>
                                <span class="collapse-icon">▼</span>
                            </div>
                            <canvas id="field-preview-canvas"></canvas>
                        </div>
                        <!-- 云图显示 -->
                        <div class="field-contour-container" id="field-contour-container">
                            <div class="field-canvas-header field-collapsible-header" data-target="contour">
                                <span>🌈 应力云图</span>
                                <span class="collapse-icon">▼</span>
                            </div>
                            <canvas id="field-contour-canvas"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- 状态栏 -->
                <div id="field-status-bar" class="field-status-bar" style="display:none;">
                    <span id="field-status-icon"></span>
                    <span id="field-status-text"></span>
                    <span id="field-status-detail"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- 🆕 实验管理对话框 -->
    <div id="experimentManagerModal" class="modal" style="display: none;">
        <div class="modal-content field-modal modal-lg" style="max-height: 80vh;">
            <div class="modal-header">
                <h3>📂 实验数据管理</h3>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="btn btn-primary btn-sm" onclick="StressCalibrationModule.导出全部数据()">📊 导出全部</button>
                    <button id="deleteAllDataBtn" class="btn btn-danger btn-sm" onclick="StressCalibrationModule.删除全部数据()">🗑️ 删除全部</button>
                    <button class="modal-close" onclick="StressCalibrationModule.关闭实验管理对话框()">×</button>
                </div>
            </div>
            <div class="modal-body" style="max-height: 55vh;">
                <div id="experimentListContainer">
                    <p style="text-align: center; color: #999;">加载中...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="StressCalibrationModule.关闭实验管理对话框()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 🆕 自定义输入对话框 -->
    <div id="customPromptModal" class="modal" style="display: none;">
        <div class="modal-content field-modal modal-sm">
            <div class="modal-header">
                <h3 id="customPromptTitle">输入</h3>
                <button class="modal-close" onclick="window.closeCustomPrompt()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="customPromptMessage" style="color: #666;"></label>
                    <input type="text" id="customPromptInput" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeCustomPrompt()">取消</button>
                <button class="btn btn-primary" onclick="window.confirmCustomPrompt()">确定</button>
            </div>
        </div>
    </div>

    <!-- 🆕 波形分析 - 信号处理配置弹窗 -->
    <div id="waveformAnalysisConfigModal" class="modal" style="display: none;">
        <div class="modal-content field-modal modal-sm">
            <div class="modal-header">
                <h3>🔧 信号处理设置</h3>
                <button class="modal-close" onclick="window.closeWaveformAnalysisConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 降噪配置 -->
                <div class="form-section">
                    <div class="form-section-title">
                        <span class="section-icon">📉</span>
                        <span>降噪参数</span>
                    </div>
                    <div class="form-section-content">
                        <div class="form-group">
                            <label>降噪方法</label>
                            <select id="wa-denoise-method" class="form-input">
                                <option value="wavelet">小波降噪</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>小波基</label>
                            <select id="wa-denoise-wavelet" class="form-input">
                                <option value="sym6">sym6</option>
                                <option value="db4">db4</option>
                                <option value="coif2">coif2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>分解层数</label>
                            <input type="number" id="wa-denoise-level" class="form-input" value="5" min="1" max="10">
                        </div>
                        <div class="form-group">
                            <label>阈值模式</label>
                            <select id="wa-denoise-threshold-mode" class="form-input">
                                <option value="soft">软阈值</option>
                                <option value="hard">硬阈值</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 带通滤波配置 -->
                <div class="form-section" style="margin-top: 15px;">
                    <div class="form-section-title">
                        <span class="section-icon">🎛️</span>
                        <span>带通滤波参数</span>
                    </div>
                    <div class="form-section-content">
                        <div class="form-group">
                            <label>低频截止 (MHz)</label>
                            <input type="number" id="wa-bandpass-lowcut" class="form-input" value="1.5" min="1" max="6" step="0.1">
                            <small style="color: #666; font-size: 11px;">范围: 1-6 MHz</small>
                        </div>
                        <div class="form-group">
                            <label>高频截止 (MHz)</label>
                            <input type="number" id="wa-bandpass-highcut" class="form-input" value="3.5" min="1" max="6" step="0.1">
                            <small style="color: #666; font-size: 11px;">范围: 1-6 MHz</small>
                        </div>
                        <div class="form-group">
                            <label>滤波器阶数</label>
                            <select id="wa-bandpass-order" class="form-input">
                                <option value="2">2阶</option>
                                <option value="4">4阶</option>
                                <option value="6" selected>6阶（推荐）</option>
                                <option value="8">8阶</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeWaveformAnalysisConfigModal()">取消</button>
                <button class="btn btn-primary" onclick="window.saveWaveformAnalysisConfig()">保存</button>
            </div>
        </div>
    </div>



    <!-- 开屏画面控制脚本 -->
    <script>
        // 隐藏开屏画面的函数（iframe 方式）
        window.hideSplash = function() {
            const splash = document.getElementById('splashScreen');
            const frame = document.getElementById('splashFrame');
            
            if (splash) {
                // 先通知 iframe 内部开始淡出动画
                if (frame && frame.contentWindow && frame.contentWindow.startFadeOut) {
                    frame.contentWindow.startFadeOut();
                }
                
                // 然后隐藏整个容器
                setTimeout(() => {
                    splash.classList.add('hidden');
                    // 动画结束后移除元素
                    setTimeout(() => {
                        splash.remove();
                    }, 500);
                }, 300);
            }
        };
    </script>
    
    <!-- 模块化 JavaScript -->
    <script src="js/common.js"></script>
    <!-- 实时采集模块 -->
    <script src="js/realtime-capture/realtime-capture.js"></script>
    <!-- 波形分析模块（按依赖顺序加载）-->
    <script src="js/waveform-analysis/waveform-drawing.js"></script>
    <script src="js/waveform-analysis/waveform-zoom.js"></script>
    <script src="js/waveform-analysis/waveform-processing.js"></script>
    <script src="js/waveform-analysis/waveform-crosscorr.js"></script>
    <script src="js/waveform-analysis/waveform-analysis.js"></script>
    <!-- 应力系数标定模块 -->
    <script src="js/stress-calibration/stress-calibration-manager.js"></script>
    <script src="js/stress-calibration/stress-calibration-capture.js"></script>
    <script src="js/stress-calibration/stress-calibration.js"></script>
    <!-- 单轴应力检测模块 - 应力场测绘 -->
    <script src="js/stress-detection-uniaxial/field-canvas.js"></script>
    <script src="js/stress-detection-uniaxial/field-contour.js"></script>
    <script src="js/stress-detection-uniaxial/field-resizer.js"></script>
    <script src="js/stress-detection-uniaxial/field-calibration-panel.js"></script>
    <script src="js/stress-detection-uniaxial/field-shape-panel.js"></script>
    <script src="js/stress-detection-uniaxial/field-layout-panel.js"></script>
    <script src="js/stress-detection-uniaxial/field-capture-panel.js"></script>
    <script src="js/stress-detection-uniaxial/field-experiment-manager.js"></script>
    <script src="js/stress-detection-uniaxial/stress-detection-uniaxial.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
