# 单轴应力检测模块设计文档 v1.0 - 第1.5-B部分

> **包含章节**：第3章 界面设计 (3.3 右侧显示区 - 3.8 提示系统)  
> **上一部分**：[第1.5-A部分](./单轴应力检测模块设计文档-第1.5-A部分.md)  
> **下一部分**：[第2部分](./单轴应力检测模块设计文档-第2部分.md)

---

### 3.3 右侧显示区布局设计

#### 默认状态（采集阶段）
```
┌─────────────┬──────────────────────────────────────────────────────────┐
│             │ 右上 (50%高度)                                            │
│  左侧控制栏 ├────────────────┬─────────────────────────────────────────┤
│   (30%)     │ 数据表格 (50%) │ 当前波形 (50%)                          │
│             │ # │X │Y │σ    │  ╱╲╱╲╱╲                                │
│             │ 1 │..│..│..   │                                         │
│             ├────────────────┴─────────────────────────────────────────┤ ← 可拖拽调节
│             │ 右下 (50%高度)                                            │
│             ├────────────────┬─────────────────────────────────────────┤
│             │ [▼预览] (50%)  │ [▼云图] (50%)                           │
│             │ ┌────────────┐ │ ┌────────────┐                          │
│             │ │▶网格       │ │ │▶测点       │                          │
│             │ └────────────┘ │ └────────────┘                          │
│             │  ┌──────────┐  │  ┌──────────┐                           │
│             │  │ ● ● ● ●  │  │  │🔴🟠🟡🟢 │ ← 相同的形状+测点        │
│             │  │ ● ● ● ●  │  │  │🟢🟡🟠🔴 │   叠加应力云图          │
│             │  └──────────┘  │  └──────────┘                           │
└─────────────┴────────────────┴─────────────────────────────────────────┘
                    ↑                      ↑
              预览画布：静态          云图画布：实时刷新
              网格+刻度+密度          只控制测点显示/隐藏
              形状+测点布局           形状+测点+应力云图
              浮动控制面板
```

#### 折叠预览后
```
┌─────────────┬──────────────────────────────────────────────┐
│             │ 右上 (50%高度)                                │
│  左侧控制栏 ├────────────────┬─────────────────────────────┤
│   (30%)     │ 数据表格 (50%) │ 当前波形 (50%)              │
│             │                │                             │
│             ├────────────────┴─────────────────────────────┤ ← 可拖拽调节
│             │ 右下 (50%高度)                                │
│             ├─┬──────────────────────────────────────────┬─┤
│             │▲│ [▶预览]  [▼云图] (100%)                 │▲│
│             │ │  ┌──────────────────────────────────┐   │ │
│             │ │  │ 🔴🟠🟡🟢                        │   │ │
│             │▼│  │ 🟢🟡🟠🔴  (形状+测点+云图)    │   │▼│
│             │ │  └──────────────────────────────────┘   │ │
└─────────────┴─┴──────────────────────────────────────────┴─┘
```

#### 折叠云图后
```
┌─────────────┬──────────────────────────────────────────────┐
│             │ 右上 (50%高度)                                │
│  左侧控制栏 ├────────────────┬─────────────────────────────┤
│   (30%)     │ 数据表格 (50%) │ 当前波形 (50%)              │
│             │                │                             │
│             ├────────────────┴─────────────────────────────┤ ← 可拖拽调节
│             │ 右下 (50%高度)                                │
│             ├─┬──────────────────────────────────────────┬─┤
│             │▲│ [▼预览] (100%)  [▶云图]                 │▲│
│             │ │  ┌──────────────────────────────────┐   │ │
│             │ │  │ ● ● ● ● ● ● ●                  │   │ │
│             │▼│  │ ● ● ● ● ● ● ●  (形状+测点)     │   │▼│
│             │ │  └──────────────────────────────────┘   │ │
└─────────────┴─┴──────────────────────────────────────────┴─┘
```

#### 拖拽调整后（强调云图）
```
┌─────────────┬──────────────────────────────────────────────┐
│             │ 右上 (30%高度)                                │
│  左侧控制栏 ├────────────────┬─────────────────────────────┤
│   (30%)     │ 数据表格 (50%) │ 当前波形 (50%)              │
│             ├────────────────┴─────────────────────────────┤ ← 拖拽到这里
│             │ 右下 (70%高度)                                │
│             ├────────────────┬─────────────────────────────┤
│             │ [▶预览]        │ [▼云图] (100%)              │
│             │                │  ┌────────────────────────┐ │
│             │                │  │  🔴🟠🟡🟢            │ │
│             │                │  │  🟢🟡🟠🔴            │ │
│             │                │  │                        │ │
│             │                │  │  (形状+测点+云图)      │ │
│             │                │  │  (更大显示)            │ │
│             │                │  └────────────────────────┘ │
└─────────────┴────────────────┴─────────────────────────────┘
```

---

### 3.4 交互规则

#### 折叠/展开
- **点击标题栏**：折叠/展开面板（▼ 展开，▶ 折叠）
- **至少显示一项**：预览和云图不能同时折叠
- **折叠后**：另一项自动占满下半区域

#### 拖拽调节
- **上下拖拽**：调整上半/下半高度比例
- **左右拖拽**（上半）：调整表格/波形宽度比例
- **左右拖拽**（下半）：调整预览/云图宽度比例（展开时）

#### 默认比例
- **上下**：50% / 50%（可调范围 30%-70%）
- **上半左右**：50% / 50%（表格/波形）
- **下半左右**：50% / 50%（预览/云图，展开时）

---

### 3.5 数据表格动态表头设计

#### 设计原则
表头根据**形状类型**和**布点方式**动态切换，提供最直观的坐标显示。

#### 表头切换规则

**矩形试件 + 网格布点**
```
形状: 矩形 100×150mm | 布点: 网格 5×5

# │ X(mm) │ Y(mm) │ Δt(ns) │ σ(MPa) │状态│
1 │ 10.0  │ 10.0  │ 0.00   │ 0.0    │ ✓  │
2 │ 30.0  │ 10.0  │ 12.3   │ 45.2   │ ✓  │
3 │ 50.0  │ 10.0  │ 18.5   │ 62.1   │ ✓  │
```

**圆形试件 + 极坐标布点**
```
形状: 圆形 r=40mm | 布点: 极坐标 4圈×8点

# │ R(mm) │ θ(°)  │ Δt(ns) │ σ(MPa) │状态│
1 │ 0.0   │ -     │ 0.00   │ 0.0    │ ✓  │ ← 圆心
2 │ 10.0  │ 0     │ 12.3   │ 45.2   │ ✓  │
3 │ 10.0  │ 45    │ 15.1   │ 52.3   │ ✓  │
4 │ 10.0  │ 90    │ 18.2   │ 61.5   │ ✓  │
```

**圆形试件 + 网格布点（混合情况）**
```
形状: 圆形 r=40mm | 布点: 网格 5×5

# │ X(mm) │ Y(mm) │ Δt(ns) │ σ(MPa) │状态│
1 │ 10.0  │ 10.0  │ 0.00   │ 0.0    │ ✓  │
2 │ 30.0  │ 10.0  │ 12.3   │ 45.2   │ ✓  │
```

**自定义多边形**
```
形状: 自定义多边形 | 布点: 网格 5×5

# │ X(mm) │ Y(mm) │ Δt(ns) │ σ(MPa) │状态│
1 │ 10.0  │ 10.0  │ 0.00   │ 0.0    │ ✓  │
2 │ 25.5  │ 15.3  │ 12.3   │ 45.2   │ ✓  │
```

#### 实现逻辑

```javascript
function getTableHeaders(shapeType, layoutType) {
    /**
     * 根据形状和布点方式返回表头
     * 
     * 规则:
     * - 圆形 + 极坐标 → 使用 R、θ
     * - 其他情况 → 使用 X、Y
     */
    if (shapeType === 'circle' && layoutType === 'polar') {
        return ['#', 'R(mm)', 'θ(°)', 'Δt(ns)', 'σ(MPa)', '状态'];
    } else {
        return ['#', 'X(mm)', 'Y(mm)', 'Δt(ns)', 'σ(MPa)', '状态'];
    }
}

function renderTableRow(point, shapeType, layoutType) {
    /**
     * 渲染表格行
     * 根据表头类型显示对应的坐标
     */
    if (shapeType === 'circle' && layoutType === 'polar') {
        // 显示极坐标
        return [
            point.id,
            point.r.toFixed(1),
            point.theta === null ? '-' : point.theta.toFixed(0),
            point.timeDiff ? point.timeDiff.toFixed(2) : '-',
            point.stress ? point.stress.toFixed(2) : '-',
            getStatusIcon(point.status)
        ];
    } else {
        // 显示笛卡尔坐标
        return [
            point.id,
            point.x.toFixed(1),
            point.y.toFixed(1),
            point.timeDiff ? point.timeDiff.toFixed(2) : '-',
            point.stress ? point.stress.toFixed(2) : '-',
            getStatusIcon(point.status)
        ];
    }
}
```

#### 数据存储

**数据库中始终存储完整坐标**
```sql
CREATE TABLE field_points (
    id INTEGER PRIMARY KEY,
    experiment_id TEXT,
    point_index INTEGER,
    x_coord REAL,          -- 笛卡尔 X
    y_coord REAL,          -- 笛卡尔 Y
    r_coord REAL,          -- 极坐标 R（可选）
    theta_coord REAL,      -- 极坐标 θ（可选）
    time_diff REAL,
    stress_value REAL,
    status TEXT
);
```

**导出文件包含所有坐标**
```csv
#,X(mm),Y(mm),R(mm),θ(°),Δt(ns),σ(MPa),状态
1,50.0,50.0,0.0,-,0.00,0.0,已测
2,60.0,50.0,10.0,0,12.3,45.2,已测
3,50.0,60.0,10.0,90,15.1,52.3,已测
```

#### 用户体验优化

1. **表头提示**：鼠标悬停显示坐标系说明
   - X/Y：笛卡尔坐标系，原点在左下角
   - R/θ：极坐标系，R为半径，θ为角度（0°为正东方向）

2. **坐标转换**：提供"切换坐标显示"按钮
   - 用户可以在 X/Y 和 R/θ 之间手动切换
   - 切换时自动计算转换

3. **排序支持**：点击表头排序
   - X/Y 模式：按 X 或 Y 排序
   - R/θ 模式：按 R 或 θ 排序

4. **行选中高亮**：点击表格行时高亮显示
   - 选中行背景色：浅蓝色 `#E3F2FD`
   - 同时在预览画布和云图中高亮对应测点

5. **数据实时刷新**：
   - 采集新测点后，表格自动添加新行
   - 重测已有测点后，对应行数据自动更新
   - 刷新时有淡入动画效果

---

### 3.6 数据表格样式设计

#### CSS 样式规范

**表格容器**：
```css
.field-data-table {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.field-data-table .table-header {
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e0e0e0;
    flex-shrink: 0;
}

.table-container {
    flex: 1;
    overflow-y: auto;
    min-height: 0;
}
```

**表格样式**：
```css
#field-dataTable {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

#field-dataTable thead {
    position: sticky;
    top: 0;
    background: #f5f5f5;
    z-index: 1;
}

#field-dataTable th {
    padding: 10px 8px;
    text-align: left;
    font-weight: bold;
    color: #333;
    border-bottom: 2px solid #4CAF50;
    cursor: pointer;  /* 可点击排序 */
}

#field-dataTable th:hover {
    background: #eeeeee;
}

#field-dataTable td {
    padding: 8px;
    border-bottom: 1px solid #e0e0e0;
}

#field-dataTable tbody tr {
    cursor: pointer;
    transition: background 0.2s;
}

#field-dataTable tbody tr:hover {
    background: #f9f9f9;
}

#field-dataTable tbody tr.selected {
    background: #E3F2FD;  /* 选中行高亮 */
}

#field-dataTable tbody tr.current {
    background: #FFF9C4;  /* 当前采集测点（黄色） */
    font-weight: bold;
}

#field-dataTable tbody tr.updated {
    animation: rowUpdate 0.5s ease;  /* 数据更新动画 */
}

@keyframes rowUpdate {
    0% { background: #C8E6C9; }
    100% { background: transparent; }
}

#field-dataTable .empty-message {
    text-align: center;
    color: #999;
    padding: 20px;
}
```

**状态图标样式**：
```css
.status-icon {
    display: inline-block;
    width: 20px;
    text-align: center;
}

.status-completed { color: #4CAF50; }  /* ✓ 绿色 */
.status-pending { color: #9E9E9E; }    /* ⏳ 灰色 */
.status-current { color: #FFC107; }    /* 🟡 黄色 */
.status-skipped { color: #FF9800; }    /* ⚠️ 橙色 */
.status-error { color: #F44336; }      /* ❌ 红色 */
```

#### 表格交互行为

**点击表头排序**：
```javascript
function sortTable(column) {
    // 切换排序方向
    if (currentSortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
    } else {
        currentSortColumn = column;
        sortDirection = 'asc';
    }
    
    // 排序数据
    points.sort((a, b) => {
        let valA = a[column];
        let valB = b[column];
        return sortDirection === 'asc' ? valA - valB : valB - valA;
    });
    
    // 重新渲染表格
    renderTable();
}
```

**点击行选中**：
```javascript
function selectTableRow(pointId) {
    // 移除所有选中状态
    document.querySelectorAll('#field-dataTable tbody tr').forEach(row => {
        row.classList.remove('selected');
    });
    
    // 添加选中状态
    const row = document.querySelector(`#field-dataTable tbody tr[data-point-id="${pointId}"]`);
    row.classList.add('selected');
    
    // 在画布中高亮对应测点
    FieldCanvas.highlightPoint(pointId);
    FieldContour.highlightPoint(pointId);
}
```

**数据更新动画**：
```javascript
function updateTableRow(pointId, newData) {
    const row = document.querySelector(`#field-dataTable tbody tr[data-point-id="${pointId}"]`);
    
    // 更新数据
    row.querySelector('.time-diff').textContent = newData.timeDiff.toFixed(2);
    row.querySelector('.stress-value').textContent = newData.stress.toFixed(2);
    row.querySelector('.status').innerHTML = getStatusIcon('completed');
    
    // 添加更新动画
    row.classList.add('updated');
    setTimeout(() => {
        row.classList.remove('updated');
    }, 500);
}
```

---

### 3.7 实现要点

```javascript
// 面板状态管理
const panelState = {
    upperHeight: 50,        // 上半高度百分比
    upperLeftWidth: 50,     // 上半左侧宽度（表格）
    lowerLeftWidth: 50,     // 下半左侧宽度（预览）
    previewCollapsed: false,
    contourCollapsed: false
};

// 折叠逻辑
function togglePreview() {
    if (!panelState.previewCollapsed) {
        // 折叠预览
        panelState.previewCollapsed = true;
        panelState.lowerLeftWidth = 0;
    } else {
        // 展开预览
        panelState.previewCollapsed = false;
        panelState.lowerLeftWidth = 50;
    }
    updateLayout();
}

function toggleContour() {
    if (!panelState.contourCollapsed) {
        // 折叠云图
        panelState.contourCollapsed = true;
        panelState.lowerLeftWidth = 100;
    } else {
        // 展开云图
        panelState.contourCollapsed = false;
        panelState.lowerLeftWidth = 50;
    }
    updateLayout();
}

// 拖拽逻辑
function onDragVertical(deltaY) {
    // 调整上下比例
    panelState.upperHeight += deltaY;
    panelState.upperHeight = Math.max(30, Math.min(70, panelState.upperHeight));
    updateLayout();
}

function onDragHorizontalUpper(deltaX) {
    // 调整上半左右比例（表格/波形）
    panelState.upperLeftWidth += deltaX;
    panelState.upperLeftWidth = Math.max(30, Math.min(70, panelState.upperLeftWidth));
    updateLayout();
}

function onDragHorizontalLower(deltaX) {
    // 调整下半左右比例（预览/云图）
    if (!panelState.previewCollapsed && !panelState.contourCollapsed) {
        panelState.lowerLeftWidth += deltaX;
        panelState.lowerLeftWidth = Math.max(30, Math.min(70, panelState.lowerLeftWidth));
        updateLayout();
    }
}
```

---

### 3.7 配色方案

#### 预览画布配色

**画布底色**：
- 浅灰色 `#F5F5F5` 或纯白 `#FFFFFF`
- 营造工程图纸的专业感

**试件形状**：
- 填充：半透明浅蓝 `rgba(100, 150, 255, 0.1)`
- 边框：深蓝色 `#2196F3`，2px实线
- 孔洞：白色填充 + 红色虚线边框 `#F44336`

**网格线**（可开关）：
- 主网格：浅灰色 `#E0E0E0`，1px实线，透明度70%
- 次网格：更浅灰 `#F0F0F0`，1px虚线，透明度50%
- 刻度文字：深灰色 `#666666`，10px字号
- 原点标记：深灰色 `#424242`

**测点标记**：
- 待测：空心圆（半径4px），灰色边框 `#9E9E9E`
- 已测：实心圆（半径4px），绿色 `#4CAF50`
- 当前：高亮圆（半径6px），黄色 `#FFC107`，带2px白色光晕
- 跳过：叉号标记，橙色 `#FF9800`
- 错误：叉号标记，红色 `#F44336`
- 测点编号：黑色文字 `#212121`，12px字号

**视觉层级**（从下到上）：
```
第1层: 画布底色（浅灰/白）
第2层: 网格线（最淡，可关闭）
第3层: 试件形状（半透明蓝）
第4层: 测点标记（醒目）
第5层: 鼠标交互（最上层）
```

#### 云图配色

**色图选项**：
- Rainbow（彩虹）：红→橙→黄→绿→蓝→紫
- Jet：蓝→青→绿→黄→红
- Viridis：紫→蓝→绿→黄（色盲友好）

**色标**：
- 背景：白色半透明 `rgba(255, 255, 255, 0.9)`
- 边框：浅灰色 `#E0E0E0`
- 刻度文字：深灰色 `#424242`

#### 控制开关

**预览画布内嵌控制（右上角浮动面板）**：

**预览画布控制面板**（展开状态）：
```
┌─────────────────────────────────────────────┐
│ 预览画布                  ┌─────────────────┐│
│                           │▼网格 ☑显示网格  ││
│                           │     ☑显示刻度   ││
│                           │  ○粗 ●中 ○细   ││
│                           └─────────────────┘│
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●    (画布内容：试件形状+测点) │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
└─────────────────────────────────────────────┘
```

**预览画布控制面板**（折叠状态）：
```
┌─────────────────────────────────────────────┐
│ 预览画布                          ┌────────┐│
│                                   │▶网格   ││
│                                   └────────┘│
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●    (画布内容完全可见)       │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
│   ●  ●  ●  ●  ●                             │
│                                              │
└─────────────────────────────────────────────┘
```

**云图画布控制面板**（展开状态）：
```
┌─────────────────────────────────────────────┐
│ 应力云图                  ┌─────────────────┐│
│                           │▼测点 ☑显示测点  ││
│                           └─────────────────┘│
│                                              │
│   🔴🟠🟡🟢                                  │
│                                              │
│   🟢🟡🟠🔴                                  │
│                                              │
│   🟡🟢🔴🟠    (云图+形状+测点)             │
│                                              │
│   🟠🔴🟢🟡                                  │
│                                              │
│   🔴🟠🟡🟢                                  │
│                                              │
└─────────────────────────────────────────────┘
```

**云图画布控制面板**（折叠状态）：
```
┌─────────────────────────────────────────────┐
│ 应力云图                          ┌────────┐│
│                                   │▶测点   ││
│                                   └────────┘│
│                                              │
│   🔴🟠🟡🟢                                  │
│                                              │
│   🟢🟡🟠🔴                                  │
│                                              │
│   🟡🟢🔴🟠    (纯云图，测点隐藏)           │
│                                              │
│   🟠🔴🟢🟡                                  │
│                                              │
│   🔴🟠🟡🟢                                  │
│                                              │
└─────────────────────────────────────────────┘
```

**控制面板对比**：

| 画布类型 | 控制内容 | 选项 |
|---------|---------|------|
| **预览画布** | 网格显示 | ☑显示网格、☑显示刻度、密度（粗/中/细） |
| **云图画布** | 测点显示 | ☑显示测点（开/关） |

**交互说明**：
- **展开/折叠**：点击标题栏切换
- **半透明背景**：展开时 opacity: 0.9，鼠标悬停时 opacity: 1.0
- **默认状态**：首次打开时为折叠状态
- **记忆状态**：记住用户的展开/折叠选择

**设计理由**：
1. **预览画布**：需要网格和刻度辅助定位，帮助验证测点位置
2. **云图画布**：不需要网格（会干扰云图观察），只需控制是否显示测点标记
3. **简洁原则**：云图画布控制更简单，只有一个开关
```

#### 设计原则

1. **不干扰主体**：网格和刻度使用低对比度颜色，不抢眼
2. **层次分明**：通过透明度和颜色深浅区分不同元素
3. **状态清晰**：测点状态用颜色直观表达（绿=完成，黄=当前，灰=待测）
4. **可关闭**：网格和刻度可独立开关，保持画面干净
5. **专业感**：参考CAD和工程软件的配色风格

---

**📄 文档说明**：本文档为第1.5-B部分，包含第3章后半部分内容（右侧显示区和提示系统设计）。  
**⬅️ 上一部分**：[单轴应力检测模块设计文档-第1.5-A部分.md](./单轴应力检测模块设计文档-第1.5-A部分.md)  
**➡️ 下一部分**：[单轴应力检测模块设计文档-第2部分.md](./单轴应力检测模块设计文档-第2部分.md)


### 3.8 提示系统设计

#### 设计原则

**不使用 alert() 弹窗**，采用两种提示方式：
1. **浮动提示条**：用于一般信息、成功、警告、错误提示（3秒自动消失）
2. **模态对话框**：用于需要用户确认的重要操作（需手动确认）

#### 浮动提示条

**位置**：波形显示区上方浮动显示

```
┌─────────────┬──────────────────────────────────────────────────────────┐
│             │ 右上 (50%高度)                                            │
│  左侧控制栏 ├────────────────┬─────────────────────────────────────────┤
│   (30%)     │ 数据表格 (50%) │ 当前波形 (50%)                          │
│             │                │ ┌─────────────────────────────────────┐ │
│             │ # │X │Y │σ    │ │ ✓ 测点#5采集成功 125.3MPa      [×] │ │ ← 提示条
│             │ 1 │..│..│..   │ └─────────────────────────────────────┘ │
│             │ 2 │..│..│..   │ ┌─────────────────────────────────────┐ │
│             │ 3 │..│..│..   │ │                                     │ │
│             │                │ │      ╱╲╱╲╱╲                        │ │
│             │                │ │                                     │ │
│             │                │ │   黑色波形画布                       │ │
│             │                │ │                                     │ │
│             │                │ └─────────────────────────────────────┘ │
│             ├────────────────┴─────────────────────────────────────────┤
│             │ 右下 (50%高度)                                            │
└─────────────┴──────────────────────────────────────────────────────────┘
```

**样式设计**：
```css
/* 提示条容器 */
.message-toast {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    min-width: 300px;
    max-width: 500px;
    padding: 12px 20px;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    animation: slideDown 0.3s ease-out;
    font-size: 14px;
}

/* 成功提示 - 绿色 */
.message-toast.success {
    background: #4caf50;
    color: white;
}

/* 警告提示 - 橙色 */
.message-toast.warning {
    background: #ff9800;
    color: white;
}

/* 错误提示 - 红色 */
.message-toast.error {
    background: #f44336;
    color: white;
}

/* 信息提示 - 蓝色 */
.message-toast.info {
    background: #2196f3;
    color: white;
}

/* 关闭按钮 */
.message-toast .close-btn {
    margin-left: 15px;
    cursor: pointer;
    font-size: 18px;
    opacity: 0.8;
}

.message-toast .close-btn:hover {
    opacity: 1;
}

/* 动画 */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes slideUp {
    from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    to {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
    }
}
```

**JavaScript 实现**：
```javascript
/**
 * 显示浮动提示条
 * @param {string} message - 提示消息
 * @param {string} type - 类型: 'success' | 'warning' | 'error' | 'info'
 * @param {number} duration - 显示时长（毫秒），0表示不自动消失
 */
function showToast(message, type = 'info', duration = 3000) {
    // 创建提示条元素
    const toast = document.createElement('div');
    toast.className = `message-toast ${type}`;
    toast.innerHTML = `
        <span class="message-text">${message}</span>
        <span class="close-btn" onclick="this.parentElement.remove()">×</span>
    `;
    
    // 添加到波形显示区容器
    const waveformContainer = document.querySelector('.waveform-container');
    waveformContainer.appendChild(toast);
    
    // 自动消失
    if (duration > 0) {
        setTimeout(() => {
            toast.style.animation = 'slideUp 0.3s ease-out';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    }
}

// 使用示例
showToast('✓ 测点 #5 采集成功，应力值: 125.3 MPa', 'success');
showToast('⚠️ 波形质量较差，建议重测', 'warning');
showToast('❌ 示波器通信失败，请检查连接', 'error');
showToast('💾 数据已自动保存', 'info', 2000);
```

#### 模态对话框

**用于需要用户确认的重要操作**，样式与应力标定模块一致：

**对话框样式**：
```css
/* 遮罩层 */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 对话框容器 */
.modal-dialog {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    min-width: 400px;
    max-width: 600px;
    overflow: hidden;
}

/* 对话框标题 */
.modal-header {
    padding: 16px 20px;
    background: #f5f5f5;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-header .title {
    font-size: 16px;
    font-weight: 500;
    color: #212121;
}

.modal-header .close-btn {
    cursor: pointer;
    font-size: 20px;
    color: #757575;
}

/* 对话框内容 */
.modal-body {
    padding: 20px;
    color: #424242;
    line-height: 1.6;
}

/* 对话框底部按钮 */
.modal-footer {
    padding: 12px 20px;
    background: #fafafa;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-footer button {
    padding: 8px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.modal-footer .btn-primary {
    background: #2196f3;
    color: white;
}

.modal-footer .btn-secondary {
    background: #e0e0e0;
    color: #424242;
}

.modal-footer .btn-danger {
    background: #f44336;
    color: white;
}
```

**JavaScript 实现**：
```javascript
/**
 * 显示确认对话框
 * @param {object} options - 配置选项
 * @returns {Promise<boolean>} - 用户选择结果
 */
function showConfirmDialog(options) {
    const {
        title = '确认',
        message = '',
        icon = '⚠️',
        confirmText = '确定',
        cancelText = '取消',
        type = 'warning' // 'warning' | 'danger' | 'info'
    } = options;
    
    return new Promise((resolve) => {
        // 创建对话框
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        overlay.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-header">
                    <span class="title">${icon} ${title}</span>
                    <span class="close-btn">×</span>
                </div>
                <div class="modal-body">
                    ${message}
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary">${cancelText}</button>
                    <button class="btn-${type === 'danger' ? 'danger' : 'primary'}">${confirmText}</button>
                </div>
            </div>
        `;
        
        // 绑定事件
        const closeBtn = overlay.querySelector('.close-btn');
        const cancelBtn = overlay.querySelector('.btn-secondary');
        const confirmBtn = overlay.querySelector(`.btn-${type === 'danger' ? 'danger' : 'primary'}`);
        
        closeBtn.onclick = cancelBtn.onclick = () => {
            overlay.remove();
            resolve(false);
        };
        
        confirmBtn.onclick = () => {
            overlay.remove();
            resolve(true);
        };
        
        document.body.appendChild(overlay);
    });
}

// 使用示例
const confirmed = await showConfirmDialog({
    title: '切换实验？',
    message: '当前实验 "FIELD001 - 铝板应力分布测试" 尚未完成 (15/25 测点已采集)。\n\n💾 已采集的数据已自动保存，可稍后继续。\n\n是否切换到新实验？',
    icon: '⚠️',
    confirmText: '继续切换',
    cancelText: '取消',
    type: 'warning'
});

if (confirmed) {
    // 用户确认，执行切换
}
```

#### 提示场景分类

**使用浮动提示条的场景**：
- ✓ 采集成功：`showToast('✓ 测点 #5 采集成功，应力值: 125.3 MPa', 'success')`
- 💾 自动保存：`showToast('💾 数据已自动保存', 'info', 2000)`
- ✓ 加载标定数据：`showToast('✓ 已加载标定数据：k = 3.67 MPa/ns', 'success')`
- ✓ 云图更新：`showToast('✓ 云图已更新 (使用 15/25 个测点)', 'info')`
- ⚠️ 波形质量警告：`showToast('⚠️ 波形质量较差，建议重测', 'warning')`
- ❌ 采集失败：`showToast('❌ 采集失败：示波器无响应', 'error')`
- ❌ 通信错误：`showToast('❌ 示波器通信失败，请检查连接', 'error')`

**使用模态对话框的场景**：
- 切换实验确认
- 删除实验确认
- 完成实验确认
- 重置数据确认
- 导出数据选项

---
