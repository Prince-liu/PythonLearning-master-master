<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>启动中...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #0a0a0a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .splash-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 示波器画布容器 */
        .oscilloscope-container {
            width: 1000px;
            height: 400px;
            background: #0a0a0a;
            border: 2px solid #1a1a1a;
            border-radius: 8px;
            box-shadow: 
                0 0 30px rgba(0, 255, 0, 0.15),
                inset 0 0 80px rgba(0, 255, 0, 0.03);
            margin-bottom: 50px;
            position: relative;
            animation: containerGlow 0.8s ease-out;
        }

        @keyframes containerGlow {
            from { 
                opacity: 0;
                transform: scale(0.95);
                box-shadow: 0 0 0 rgba(0, 255, 0, 0);
            }
            to { 
                opacity: 1;
                transform: scale(1);
                box-shadow: 
                    0 0 30px rgba(0, 255, 0, 0.15),
                    inset 0 0 80px rgba(0, 255, 0, 0.03);
            }
        }

        #oscilloscopeCanvas {
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }

        /* 标题区域 */
        .title-area {
            text-align: center;
            animation: titleFadeIn 1s ease-out 0.3s both;
        }

        @keyframes titleFadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .main-title {
            font-size: 32px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 
                0 0 10px rgba(0, 255, 0, 0.8),
                0 0 20px rgba(0, 255, 0, 0.4),
                0 0 30px rgba(0, 255, 0, 0.2);
            margin-bottom: 12px;
            letter-spacing: 3px;
        }

        .subtitle {
            font-size: 13px;
            color: #00ff00;
            opacity: 0.6;
            letter-spacing: 2px;
            margin-bottom: 25px;
        }

        .status-text {
            font-size: 12px;
            color: #00ff00;
            opacity: 0.5;
            letter-spacing: 1px;
        }

        .status-text .cursor {
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* 功能标签 */
        .features {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 25px;
            animation: featuresFadeIn 1s ease-out 0.8s both;
        }

        @keyframes featuresFadeIn {
            from { 
                opacity: 0; 
                transform: translateX(-50%) translateY(10px);
            }
            to { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0);
            }
        }

        .feature-tag {
            font-size: 11px;
            color: #00ff00;
            opacity: 0.4;
            padding: 5px 15px;
            border: 1px solid rgba(0, 255, 0, 0.2);
            border-radius: 3px;
            background: rgba(0, 255, 0, 0.03);
            letter-spacing: 1px;
        }

        /* 版本信息 */
        .version {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #00ff00;
            opacity: 0.3;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="splash-container">
        <!-- 示波器画布 -->
        <div class="oscilloscope-container">
            <canvas id="oscilloscopeCanvas"></canvas>
        </div>

        <!-- 标题区域 -->
        <div class="title-area">
            <div class="main-title">ULTRASONIC STRESS DETECTION SYSTEM</div>
            <div class="subtitle">超声波应力检测系统</div>
            <div class="status-text">INITIALIZING SYSTEM<span class="cursor">_</span></div>
        </div>

        <!-- 功能标签 -->
        <div class="features">
            <div class="feature-tag">REAL-TIME CAPTURE</div>
            <div class="feature-tag">WAVEFORM ANALYSIS</div>
            <div class="feature-tag">STRESS CALIBRATION</div>
        </div>

        <!-- 版本信息 -->
        <div class="version">v1.0.0 | Python + pywebview | EdgeChromium</div>
    </div>

    <script>
        // 获取画布和上下文
        const canvas = document.getElementById('oscilloscopeCanvas');
        const ctx = canvas.getContext('2d');

        // 设置画布尺寸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        resizeCanvas();

        // 绘制参数
        const gridColor = '#1a1a1a';
        const waveColor = '#00ff00';
        const glowColor = 'rgba(0, 255, 0, 0.3)';
        
        let phase = 0;
        let progress = 0;
        const totalDuration = 2000; // 2秒完成绘制
        const startTime = Date.now();

        // 绘制网格
        function drawGrid() {
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 1;

            const width = canvas.width;
            const height = canvas.height;
            const gridSize = 40;

            // 垂直线
            for (let x = 0; x <= width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // 水平线
            for (let y = 0; y <= height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // 中心十字线（加粗）
            ctx.strokeStyle = '#2a2a2a';
            ctx.lineWidth = 2;
            
            // 垂直中心线
            ctx.beginPath();
            ctx.moveTo(width / 2, 0);
            ctx.lineTo(width / 2, height);
            ctx.stroke();
            
            // 水平中心线
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        // 波形生成函数 - 多重超声回波（更真实的衰减效果）
        function getWaveValue(x, width) {
            const t = (x / width) * 10 * Math.PI;
            
            let signal = 0;
            const carrierFreq = 8; // 高频载波（模拟超声频率）
            
            // 定义多个回波脉冲（模拟超声在材料中的多次反射）
            const echoes = [
                { center: 1.2 * Math.PI, amplitude: 1.0, width: 0.6 },   // 发射脉冲
                { center: 3.5 * Math.PI, amplitude: 0.75, width: 0.65 }, // 第一次回波（底面反射）
                { center: 5.8 * Math.PI, amplitude: 0.50, width: 0.7 },  // 第二次回波
                { center: 8.0 * Math.PI, amplitude: 0.30, width: 0.75 }, // 第三次回波（衰减明显）
                { center: 9.8 * Math.PI, amplitude: 0.15, width: 0.8 }   // 第四次回波（微弱）
            ];
            
            // 叠加所有回波
            echoes.forEach(echo => {
                // 高斯包络（模拟脉冲形状）
                const envelope = Math.exp(-Math.pow((t - echo.center) / echo.width, 2));
                
                // 高频载波 + 包络 + 振幅衰减
                const pulse = Math.sin(t * carrierFreq + phase) * envelope * echo.amplitude;
                
                signal += pulse;
            });
            
            // 添加微弱的噪声（模拟真实信号）
            signal += (Math.random() - 0.5) * 0.02 * (progress >= 1 ? 1 : 0);
            
            return signal;
        }

        // 绘制波形
        function drawWaveform() {
            const width = canvas.width;
            const height = canvas.height;
            const centerY = height / 2;
            const amplitude = height * 0.35;
            
            // 计算当前进度（0-1）
            const elapsed = Date.now() - startTime;
            progress = Math.min(elapsed / totalDuration, 1);
            
            // 绘制到当前进度的位置（初始绘制阶段）或整个宽度（完成后）
            const endX = progress >= 1 ? width : width * progress;
            
            // 绘制发光效果（多层，更强的辉光）
            for (let i = 4; i >= 1; i--) {
                ctx.strokeStyle = glowColor;
                ctx.lineWidth = i * 4;
                ctx.globalAlpha = 0.25 / i;
                
                ctx.beginPath();
                for (let x = 0; x <= endX; x += 2) {
                    const waveValue = getWaveValue(x, width);
                    const y = centerY + waveValue * amplitude;
                    
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // 绘制主波形
            ctx.strokeStyle = waveColor;
            ctx.lineWidth = 2.5;
            ctx.globalAlpha = 1;
            
            ctx.beginPath();
            for (let x = 0; x <= endX; x += 2) {
                const waveValue = getWaveValue(x, width);
                const y = centerY + waveValue * amplitude;
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 绘制回波标记（完成后显示）
            if (progress >= 1) {
                const echoPositions = [
                    { x: width * 0.12, label: 'T₀', color: 'rgba(0, 255, 0, 0.6)' },
                    { x: width * 0.35, label: 'E₁', color: 'rgba(0, 255, 0, 0.5)' },
                    { x: width * 0.58, label: 'E₂', color: 'rgba(0, 255, 0, 0.4)' },
                    { x: width * 0.80, label: 'E₃', color: 'rgba(0, 255, 0, 0.3)' },
                    { x: width * 0.98, label: 'E₄', color: 'rgba(0, 255, 0, 0.2)' }
                ];
                
                ctx.font = '11px Consolas';
                ctx.textAlign = 'center';
                
                echoPositions.forEach(echo => {
                    // 绘制垂直标记线
                    ctx.strokeStyle = echo.color;
                    ctx.lineWidth = 1;
                    ctx.setLineDash([4, 4]);
                    ctx.beginPath();
                    ctx.moveTo(echo.x, height * 0.15);
                    ctx.lineTo(echo.x, height * 0.85);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // 绘制标签
                    ctx.fillStyle = echo.color;
                    ctx.fillText(echo.label, echo.x, height * 0.1);
                });
            }
            
            // 绘制扫描光标（在波形末端，仅在初始绘制阶段）
            if (progress < 1) {
                // 光标主线
                ctx.strokeStyle = waveColor;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.8;
                ctx.beginPath();
                ctx.moveTo(endX, 0);
                ctx.lineTo(endX, height);
                ctx.stroke();
                
                // 光标辉光
                ctx.strokeStyle = glowColor;
                ctx.lineWidth = 8;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.moveTo(endX, 0);
                ctx.lineTo(endX, height);
                ctx.stroke();
                
                ctx.globalAlpha = 1;
            }
        }

        // 动画循环
        function animate() {
            // 清空画布
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制网格
            drawGrid();
            
            // 绘制波形
            drawWaveform();
            
            // 更新相位（波形完成后开始滚动）
            if (progress >= 1) {
                phase += 0.02;
            }
            
            requestAnimationFrame(animate);
        }

        // 启动动画
        animate();

        // 淡出函数
        function fadeOut() {
            const container = document.querySelector('.splash-container');
            container.style.transition = 'opacity 0.8s ease-out';
            container.style.opacity = '0';
            
            document.body.style.transition = 'opacity 0.8s ease-out';
            document.body.style.opacity = '0';
        }

        // 暴露给 Python 调用
        window.startFadeOut = fadeOut;
    </script>
</body>
</html>
